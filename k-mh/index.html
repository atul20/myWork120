
//
//  ViewTab.m
//  QikView
//
//  Created by Esense114 on 10/11/14.
//  Copyright (c) 2014 Esense. All rights reserved.
//

#import "ViewTab.h"
#import "LeveyTabBarController.h"
#import "MainScreenWireframe.h"
#import "ViewCustomCell.h"
#import "ADLivelyCollectionView.h"
#import "VideoPlayer.h"
#import <AVFoundation/AVFoundation.h>
#import "UIViewController+MaryPopin.h"
#import "AddHighlightOptions.h"
#import "Canvas.h"
#import "WDActivityIndicator.h"
#import "EditCellPopUp.h"
#import <KeyboardManager/KeyboardManager.h>
#import "RecordHighlight.h"
#import "RNFrostedSidebar.h"
#import "AppDelegate.h"
#import "Login.h"
#import "VideoThumnailVCPopUp.h"
#import <Social/Social.h>
#import <FacebookSDK/FacebookSDK.h>
#import "LibraryTab.h"
#import "ESSYouTube.h"
#import "ESSFacebook.h"
#import "ESSFlickr.h"
#import "VideoPlayer.h"
#import "ASIFormDataRequest.h"
#import "Login.h"
//#import "UCZProgressView.h"


//ForDropBox
#import <DropboxSDK/DropboxSDK.h>

#include <MediaPlayer/MediaPlayer.h>
#import "Constant.h"
#import <AssetsLibrary/AssetsLibrary.h>
#import "settingViewController.h"

@interface ViewTab () <LeveyTabBarControllerDelegate, UICollectionViewDataSource, UICollectionViewDelegate,UICollectionViewDelegateFlowLayout, UIScrollViewDelegate, UITextFieldDelegate,UIAlertViewDelegate,RNFrostedSidebarDelegate,UIActionSheetDelegate, LeveyTabBarDelegate,UIScrollViewDelegate,VideoPlayerDelegate, DBRestClientDelegate> {
    
    //  IBOutlet ADLivelyCollectionView *viewTabCollectionView;
    IBOutlet UICollectionViewFlowLayout *viewTabCollectionFlow;
    IBOutlet UIView *optionsView;
    IBOutlet UIView *libraryRecordOpenView;
    IBOutlet UITextField *searchTextField;
    BOOL isOptionsViewHidden;
    NSMutableArray *collect, *cellImagesArray, *videoURLArray, *highlightNamesArray;
    NSMutableArray *sortedDocDirContents;
    
    NSMutableArray *highlightNameMatchesArray, *cellImagesMatchesArray, *videoURLMatchesArray;
    
    AddHighlightOptions *addHighlightOptionsObject;
    UIVisualEffectView *contextMenu;
    // context menu
    UIImageView *contextMenuBaseImageView;
    UIButton *share, *edit, *delete;
    NSUInteger selectedIndex;
    
    
    
    RecordHighlight *recordObject;//Cjo
    UIBarButtonItem *right;
    UIButton *btn;
    
    
    IBOutlet UIButton *GoTop;
    
    NSUInteger selectedThumbnailIndex;
    
    ViewCustomCell *cell;
    IBOutlet UITapGestureRecognizer *SingleTap;
    IBOutlet UITapGestureRecognizer *DoubleTap;
    
    //Suraj
    UIButton *btnDropBox;
    
    /// Demo Video Play
    MPMoviePlayerController *moviePlayerController;
    
    LeveyTabBarController *tabBC;
    
    /// Integer to Play Searched Video
    int playSearchVideoIndex;
    
    
    NSString *oldPasawordStore,*newPassWordStore,*newpassStore,*ReEntnewPasawordStore;
    
    ESSYouTube *youTube;
    ESSFacebook *facebook;
    ESSFlickr *flickr;
    //UCZProgressView *progressView;
    
    BOOL gridView;
    BOOL swipeView;
    BOOL scrollView;
    BOOL forOptionsView;
    BOOL libraryRecordOpenViewBool;
    
    
    NSTimer*stopVideoTimer; // Timer to stop Video Play of add after highlight creation finishes
    BOOL hideOptionView;
    
    UIVisualEffectView *visualEffectView;
    IBOutlet UIView *userinfoview;
    IBOutlet UILabel *usernameTxt;
    IBOutlet UILabel *passwordTxt;
    IBOutlet UIButton *cancelBtn;
    IBOutlet UIView *changePasswordView;
    IBOutlet UIButton *changePassWord;
    IBOutlet UITextField *Oldpassword;
    IBOutlet UITextField *newPassword;
    IBOutlet UITextField *newPasswordRe;
    IBOutlet UIButton * doneChangePassWord;
    IBOutlet UIButton *cancelBtnChangePassView;
    
    
    
}

// methods
- (void)refreshNavigationBar;
- (void)showOptionsView;
- (void)hideOptionsView;
- (void)loadVideoInPlayerAtIndex:(NSInteger)index;
+ (UIImage *)getThumbnailForVideoAtURL:(NSURL *)videoURL;
- (void)getDocDirContent;
- (UIButton *)getAddButtonWithFrame:(CGRect)frame;
- (CGRect)getAddViewFrame;
- (UIVisualEffectView *)getContextMenu;
- (NSArray *)getVideosAccordingToDate;
- (NSString *)stringFromTimeInterval:(double)interval;
- (void)hideContextMenu;
- (void)showSearchButtonOnRight;
- (void)showTextFieldSearchOnRight;
- (void)getSearchResultsForQuery:(NSString *)query;

// IBActions
- (void)menuButtonTapped:(id)sender;
- (void)searchButtonTapped:(id)sender;
- (IBAction)gridViewButtonTapped:(id)sender;
- (IBAction)swipViewButtonTapped:(id)sender;
- (IBAction)scrollViewButtonTapped:(id)sender;
- (IBAction)textFieldTextDidChange:(id)sender;
- (void)addNewHighlightButtonTapped:(id)sender;
- (void)highlightLongPressed:(UILongPressGestureRecognizer *)longPress;
- (void)shareFunction:(id)sender;
- (void)contextMenuBkgndTapped:(UITapGestureRecognizer *)tap;
- (void)doneButtonPressed:(id)sender;
- (void)searchCancelButtonPressed:(id)sender;
- (IBAction)TapOnCell:(id)sender;
- (IBAction)DoubleTap:(id)sender;


@property(nonatomic, strong)DBRestClient *restClient;
@end

@implementation ViewTab
//@synthesize seleltedImageURLmArray,whichVC;
@synthesize seleltedImageURLmArray,whichVC,statusView,proessingText, viewTabCollectionView;

- (instancetype)init
{
    self = [super init];
    if (self) {
        
        // left bar button
        UIImage *leftImg = [UIImage imageNamed:@"menu.png"];
        UIBarButtonItem *left = [[UIBarButtonItem alloc] initWithImage:leftImg style:UIBarButtonItemStyleDone target:self action:@selector(menuButtonTapped:)];
        left.tintColor = [UIColor whiteColor];
        self.navigationItem.leftBarButtonItem = left;
        
        
        //        UIView * container = [[UIView alloc]initWithFrame:CGRectMake(0, 30, 30,30)];
        //
        //        UIButton * button = [[UIButton alloc]initWithFrame:CGRectZero];
        //        [button addTarget:self action:@selector(addNewHighlightButtonTapped:) forControlEvents:UIControlEventTouchUpInside];
        //        [button setImage:[UIImage imageNamed:@"Plus.png"] forState:UIControlStateNormal];
        //        [button setTitle:@"" forState:UIControlStateNormal];
        //        [button sizeToFit];
        //        [container addSubview:button];
        //        [container sizeToFit];
        // self.navigationItem.titleView = container;
        // right bar button
        [self showSearchButtonOnRight];
        
    }
    return self;
}



- (void)viewDidLoad {
    
    [super viewDidLoad];
    
    playSearchVideoIndex = 0;
    
    NSLog(@"%@",[[NSUserDefaults standardUserDefaults]valueForKey:@"login"]);
    NSLog(@"%@",[[NSUserDefaults standardUserDefaults]valueForKey:@"tryAsGuest"]);
    
    self.optionIndices = [NSMutableIndexSet indexSetWithIndex:1];
    _GlobalIsProcessing = NO;
    
    addHighlightOptionsObject = [[AddHighlightOptions alloc] init];
    [self.navigationController presentPopinController:addHighlightOptionsObject animated:NO completion:nil];
    [self.navigationController dismissCurrentPopinControllerAnimated:NO];
    
    [viewTabCollectionView setDelegate:self];
    
    // Do any additional setup after loading the view from its nib.
    [self.view setBackgroundColor:[UIColor colorWithPatternImage:[UIImage imageNamed:@"background"]]];
    
    //[self.view setBackgroundColor:[UIColor whiteColor]];
    
    [self setAutomaticallyAdjustsScrollViewInsets:NO];
    
    // tab bar delegate
    tabBC = [MainScreenWireframe getMainScreenWireframe];
    
    tabBC.delegate = self;
    
    // collection view
    [viewTabCollectionView registerNib:[UINib nibWithNibName:@"ViewCustomCell" bundle:nil] forCellWithReuseIdentifier:@"CELL"];
    //   viewTabCollectionView.initialCellTransformBlock = ADLivelyTransformGrow;
    
    // doc dir
    [self getDocDirContent];
    
    // bool
    isOptionsViewHidden = YES;
    
    // to detect taps on collectionview background
    viewTabCollectionView.backgroundView = [[UIView alloc] init];
    [viewTabCollectionView.backgroundView addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapOnBackgroundRecognized)]];
    
    // search text field
    UIView *spacerViewL = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 9, 9)];
    searchTextField.leftViewMode = UITextFieldViewModeAlways;
    [searchTextField setLeftView:spacerViewL];
    searchTextField.delegate = self;
    UIView *spacerViewR = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 32, 32)];
    UIImageView *imgV = [[UIImageView alloc] initWithFrame:spacerViewR.bounds];
    imgV.contentMode = UIViewContentModeCenter;
    btn = [UIButton buttonWithType:UIButtonTypeCustom];
    btn.frame = spacerViewR.bounds;
    [btn setTitle:@"x" forState:UIControlStateNormal];
    [btn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
    //[btn setImage:searchImg forState:UIControlStateNormal];
    [btn addTarget:self action:@selector(searchCancelButtonPressed:) forControlEvents:UIControlEventTouchUpInside];
    [spacerViewR addSubview:btn];
    searchTextField.rightViewMode = UITextFieldViewModeAlways;
    [searchTextField setRightView:spacerViewR];
    
    UIColor *textColor = [UIColor whiteColor];
    searchTextField.font = SET_FONT(VERLAG_LIGHT, 15.0);
    searchTextField.textColor = textColor;
    NSAttributedString *placeholderAttributedString = [[NSAttributedString alloc] initWithString:@"Enter your search keyword here" attributes:@{NSForegroundColorAttributeName:textColor}];
    searchTextField.attributedPlaceholder = placeholderAttributedString;
    
    [searchTextField addDoneOnKeyboardWithTarget:self action:@selector(doneButtonPressed:)];
    
    [SingleTap requireGestureRecognizerToFail:DoubleTap];
    
    //statusBar
    UIView *addStatusBar = [[UIView alloc] init];
    
    addStatusBar.frame = CGRectMake(0, 0, 320, 20);
    
    //change this to match your navigation bar or view color or tool bar
    
    //You can also use addStatusBar.backgroundColor = [UIColor BlueColor]; or any other color
    
    //addStatusBar.backgroundColor = [UIColor colorWithRed:0.973/255. green:0.973/255. blue:0.973/255. alpha:1];
    
    addStatusBar.backgroundColor = [UIColor whiteColor];
    [self.view addSubview:addStatusBar];
    
    [self call];
    
    
    [UIView animateWithDuration:0.5 animations:^{
        libraryRecordOpenView.frame = CGRectMake(0, 650, 300, 80);
    }];
    
    
    
    //code for share video to youtube
    
    id delegate = self;
    NSString *youTubeAPIKey = @"AI39si4TasUaD3IHnm9yGka3BgQdok10A0xVo6UIp89KPJqufL3aBBXG2rCIVJDxcUcS4AFtQLuI7Eudd75rwOROUK-jnt-agg";
    
    
    youTube = [[ESSYouTube alloc] initWithDelegate:delegate
                                      developerKey:youTubeAPIKey];
    //    sejo used create key create
    // NSString *facebookAppID = @"340614986125164";
    
    //old key given by client
    //    NSString *facebookAppID = @"311868909007937";
    //    NSString *facebookAppSecret = @"2463b56ff13d1fb15b94a5eb67f5c94f";
    //    facebook = [[ESSFacebook alloc] initWithDelegate:delegate appID:facebookAppID appSecret:facebookAppSecret];
    
    //atul create key create
    NSString *facebookAppID = @"1594093720806472";
    NSString *facebookAppSecret = @"1157faf85d295cbcb267fdfce48ebf27";
    facebook = [[ESSFacebook alloc] initWithDelegate:delegate appID:facebookAppID appSecret:facebookAppSecret];
    
    
    NSString *flickrAppKey = @"01f06a84a1aa3fb5880526390143d84d";
    NSString *flickrAppSecret = @"e309cfb2dccc5195";
    flickr = [[ESSFlickr alloc] initWithDelegate:self applicationKey:flickrAppKey applicationSecret:flickrAppSecret];
    
    
    [appDelHUD hide:YES];
    [visualEffectViewAppDel removeFromSuperview];
    
    [self initialiseUserInfoView];
}
-(void)initialiseUserInfoView{
    
    //userinfoview password view
    
    userinfoview.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.5];
    userinfoview.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    
    usernameTxt.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    usernameTxt.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    usernameTxt.layer.borderWidth = 0.5;
    
    //textField.font = SET_FONT(MYRIAD_ULTRA_LIGHT, 21.0);
    
    
    passwordTxt.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    passwordTxt.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    passwordTxt.layer.borderWidth = 0.5;
    
    
    cancelBtn.titleLabel.numberOfLines = 1;
    cancelBtn.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    
    changePassWord.titleLabel.numberOfLines = 1;
    changePassWord.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    
    
    
    
    //change password view
    
    changePasswordView.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.5];
    changePasswordView.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    
   
    Oldpassword.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    Oldpassword.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    Oldpassword.layer.borderWidth = 0.5;
    
    UIColor *color = [UIColor whiteColor];
    Oldpassword.attributedPlaceholder = [[NSAttributedString alloc] initWithString:@"Enter Old Password" attributes:@{NSForegroundColorAttributeName: color}];
    
    newPassword.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    newPassword.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    newPassword.layer.borderWidth = 0.5;
    newPassword.attributedPlaceholder = [[NSAttributedString alloc] initWithString:@"Enter New Password" attributes:@{NSForegroundColorAttributeName: color}];
    
    newPasswordRe.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    newPasswordRe.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    newPasswordRe.layer.borderWidth = 0.5;
    newPasswordRe.attributedPlaceholder = [[NSAttributedString alloc] initWithString:@"Re-Enter Old Password" attributes:@{NSForegroundColorAttributeName: color}];
    
    
    cancelBtnChangePassView.titleLabel.numberOfLines = 1;
    cancelBtnChangePassView.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    
    doneChangePassWord.titleLabel.numberOfLines = 1;
    doneChangePassWord.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    
}

- (void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:YES];
    
    [self refreshNavigationBar];
    
    
    
    [UIView animateWithDuration:0.5 animations:^{
        libraryRecordOpenView.frame = CGRectMake(0, 650, 300, 80);
    }];
    
    [[MainScreenWireframe getMainScreenWireframe] hidesTabBar:NO animated:YES];
    if (deleteCellWhileProcessing)
    {
        
    }
    else
        
    {
        //ForDropBox
        //[self updateButtons];
        
        [self showSearchButtonOnRight];
        //[optionsView setEnablePrevious:YES next:YES];
        //[self reloadCollectionViewwrtSearch];
        
    }
    [UIView animateWithDuration:0.5 animations:^{
        libraryRecordOpenView.frame = CGRectMake(0, 650, 300, 80);
    }];
    
    [self getDocDirContent];
    [viewTabCollectionView reloadData];
}

//ForDropBox

- (void)viewDidUnload {
    
    btnDropBox = nil;
}

//---||

-(void)viewDidAppear:(BOOL)animated{
    [super viewDidAppear:YES];
    NSNumber *value = [NSNumber numberWithInt:UIInterfaceOrientationPortrait];
    [[UIDevice currentDevice]setValue:value forKey:@"orientation"];
    // [self hideOptionsView];
    // [self showOptionsView];
    [optionsView setFrame:CGRectMake(35, 583, 250, 51)];
    [right setEnabled:YES];
    
    //    [viewTabCollectionView setTranslatesAutoresizingMaskIntoConstraints:NO];
    //    [viewTabCollectionView setNeedsUpdateConstraints];
    
    
}
- (void)willRotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration{
    [viewTabCollectionView setTranslatesAutoresizingMaskIntoConstraints:NO];
    [viewTabCollectionView setNeedsUpdateConstraints];
    
}


- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}


#pragma mark - My methods

- (void)showSearchButtonOnRight {
    
    UIImage *rightImg = [UIImage imageNamed:@"search"];
    right = [[UIBarButtonItem alloc] initWithImage:rightImg style:UIBarButtonItemStyleDone target:self action:@selector(searchButtonTapped:)];
    right.tintColor = [UIColor whiteColor];
    self.navigationItem.rightBarButtonItem = right;
    [right setEnabled:YES];//cjo
}

- (void)showTextFieldSearchOnRight {
    
    //[UIView animateWithDuration:0.3 animations:^{
    self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:searchTextField];
    //}];
    [searchTextField becomeFirstResponder];
}

- (NSArray *)getVideosAccordingToDate {
    
    NSArray *documentPath = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
    NSString *currDircetory = [documentPath objectAtIndex:0];
    currDircetory = [currDircetory stringByAppendingPathComponent:@"MyHighlights"];
    NSArray *filePathsArray = [[NSFileManager defaultManager] contentsOfDirectoryAtPath:currDircetory error:nil];
    
    
    // sort by creation date
    NSMutableArray* filesAndProperties = [NSMutableArray arrayWithCapacity:[filePathsArray count]];
    for(NSString* file in filePathsArray) {
        NSString* filePath = [currDircetory stringByAppendingPathComponent:file];
        
        NSDictionary* properties = [[NSFileManager defaultManager]
                                    attributesOfItemAtPath:filePath
                                    error:nil];
        NSDate* modDate = [properties objectForKey:NSFileModificationDate];
        [filesAndProperties addObject:[NSDictionary dictionaryWithObjectsAndKeys:
                                       file, @"path",
                                       modDate, @"lastModDate",
                                       nil]];
        //        if(error == nil)
        //        {
        //
        //        }
    }
    
    // sort using a block
    // order inverted as we want latest date first
    NSArray* sortedFiles = [filesAndProperties sortedArrayUsingComparator:
                            ^(id path1, id path2)
                            {
                                // compare
                                NSComparisonResult comp = [[path1 objectForKey:@"lastModDate"] compare:
                                                           [path2 objectForKey:@"lastModDate"]];
                                // invert ordering
                                if (comp == NSOrderedDescending) {
                                    comp = NSOrderedAscending;
                                }
                                else if(comp == NSOrderedAscending){
                                    comp = NSOrderedDescending;
                                }
                                return comp;
                            }];
    return sortedFiles;
}

- (IBAction)GoTop:(id)sender {
    
    [viewTabCollectionView scrollRectToVisible:CGRectMake(0, 0, viewTabCollectionView.frame.size.width, viewTabCollectionView.frame.size.height) animated:YES];
    
    
}

- (void)getDocDirContent {
    
    dispatch_async(dispatch_get_main_queue(), ^{
        
        NSString *string = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
        NSString *string2 = [string stringByAppendingPathComponent:@"MyHighlights"];
        NSLog(@"document directory path:\n%@", string2);
        
        BOOL choice = YES;
        if (![[NSFileManager defaultManager] fileExistsAtPath:string2 isDirectory:&choice]) {
            [[NSFileManager defaultManager] createDirectoryAtPath:string2 withIntermediateDirectories:YES attributes:nil error:nil];
        }
        
        NSArray *sortedContents = [self getVideosAccordingToDate];
        sortedContents = [sortedContents valueForKey:@"path"];
        NSMutableArray *mContents = [sortedContents mutableCopy];
        
        // for simulator testing
#if (TARGET_IPHONE_SIMULATOR)
        if (mContents.count) {
            [mContents removeObjectAtIndex:0];
        }
#endif
        
        // saving to keep track for deletions
        sortedDocDirContents = [[NSMutableArray alloc] initWithArray:mContents];
        
        for (int i=0; i<mContents.count; i++) {
            NSString *path = [string2 stringByAppendingPathComponent:mContents[i]];
            NSURL *fileURL = [NSURL fileURLWithPath:path];
            [mContents replaceObjectAtIndex:i withObject:fileURL];
        }
        
        NSMutableArray *thumbs = [[NSMutableArray alloc] init];
        
        for (NSURL *url in mContents)
        {
            UIImage *img = [ViewTab getThumbnailForVideoAtURL:url];
            if (img == nil)
            {
                UIGraphicsBeginImageContextWithOptions(CGSizeMake(36, 36), NO, 0.0);
                UIImage *blank = UIGraphicsGetImageFromCurrentImageContext();
                UIGraphicsEndImageContext();
                img = blank;
            }
            [thumbs addObject:img];
        }
        
        // for simulator testing
#if (TARGET_IPHONE_SIMULATOR)
        if (mContents.count) {
            NSMutableArray *mArr = [[NSMutableArray alloc] initWithArray:sortedContents];;
            [mArr removeObjectAtIndex:0];
            collect = [[NSMutableArray alloc] initWithArray:mArr];
        }
#else
        collect = [[NSMutableArray alloc] initWithArray:sortedContents];
#endif
        
        highlightNamesArray = [[NSMutableArray alloc] init];
        for (int i=0; i<collect.count; i++) {
            NSString *fileName = [collect objectAtIndex:i];
            fileName = [[fileName componentsSeparatedByString:@"."] firstObject];
            [highlightNamesArray addObject:fileName];
        }
        
        cellImagesArray = [[NSMutableArray alloc] initWithArray:thumbs];
        
        videoURLArray = [[NSMutableArray alloc] initWithArray:mContents];
        
        highlightNameMatchesArray = [[NSMutableArray alloc] initWithArray:highlightNamesArray];
        //NSLog(@"highlightNameMatchesArray %lu",(unsigned long)highlightNameMatchesArray.count);
        
        NSData *data = [NSKeyedArchiver archivedDataWithRootObject:highlightNameMatchesArray];
        [[NSUserDefaults standardUserDefaults] setObject:data forKey:@"countArray"];
        
        cellImagesMatchesArray = [[NSMutableArray alloc] initWithArray:cellImagesArray];
        
        videoURLMatchesArray = [[NSMutableArray alloc] initWithArray:videoURLArray];
        
        //         NSLog(@"highlightNameMatchesArray %lu",(unsigned long)highlightNameMatchesArray.count);
        //         NSLog(@"highlightNameMatchesArray %@",highlightNameMatchesArray);
        //         NSLog(@"highlightNameMatchesArray %@",cellImagesMatchesArray);
        //         NSLog(@"highlightNameMatchesArray %@",videoURLMatchesArray);
        
        if(isProcessingViewHideWhenSavingVideo==YES)
        {
            [statusView removeFromSuperview];
            isProcessingViewHideWhenSavingVideo=NO;
        }
        [viewTabCollectionView reloadData];
    });
}

- (void)reloadData {
    
    [viewTabCollectionView performBatchUpdates:^{
        [viewTabCollectionView reloadSections:[NSIndexSet indexSetWithIndex:0]];
        NSData *data = [NSKeyedArchiver archivedDataWithRootObject:highlightNameMatchesArray];
        [[NSUserDefaults standardUserDefaults] setObject:data forKey:@"countArray"];
    } completion:nil];
}


- (void)refreshNavigationBar {
    
    UIImage *navBkgndImg = [UIImage imageNamed:@"backgroundNavigationBar.png"];
    //UIImage *navBkgndImg = [UIImage imageNamed:@"backgroundLibraryDark.png"];
    UIImage *navShadowImg = [[UIImage alloc] init];
    
    [self.navigationController.navigationBar setBackgroundImage:navBkgndImg forBarMetrics:UIBarMetricsDefault];
    [self.navigationController.navigationBar setShadowImage:navShadowImg];
}

- (void)showOptionsView {
    //self.view.backgroundColor = [UIColor colorWithWhite:1 alpha:0];
    
    UIImage *bkgndImg = [ViewTab imageWithColor:COLOR(81.0, 186.0, 67.0, 0.4)];
    optionsView.backgroundColor = [UIColor colorWithPatternImage:bkgndImg];
    
    //NSLog(@"%@",NSStringFromCGRect(optionsView.frame));
    //    CGFloat currentY = optionsView.bounds.origin.y;
    //    CGFloat height = optionsView.bounds.size.height;
    //    CGFloat screenHeight = [UIScreen mainScreen].bounds.size.height;
    if (!hideOptionView)
    {
        
        [UIView animateWithDuration:0.5 animations:^{
            //[self.navigationController.navigationBar setHidden:YES];
            
            optionsView.frame = CGRectMake(35, 465, 250, 51);
        }];
        hideOptionView = YES;
    }
    else
    {
        [UIView animateWithDuration:0.5 animations:^{
            // [self.navigationController.navigationBar setHidden:NO];
            
            optionsView.frame = CGRectMake(35, 583, 250, 51);
        }];
        
        hideOptionView = NO;
    }
    //    if (currentY == screenHeight - height)
    //if (currentY < 1)
    {
        //        CGFloat x = optionsView.frame.origin.x;
        //        CGFloat newY = currentY - optionsView.frame.size.height;
        //        CGFloat width = optionsView.frame.size.width;
        //        CGRect newFrame = CGRectMake(x, newY, width, height);
        
        //        [UIView animateWithDuration:0.5 animations:^{
        //            optionsView.frame = newFrame;
        //        }];
    }
    
    
    forOptionsView=NO;
    isOptionsViewHidden = NO;
}

+ (UIImage *)imageWithColor:(UIColor *)color {
    CGRect rect = CGRectMake(0.0f, 0.0f, 1.0f, 1.0f);
    UIGraphicsBeginImageContext(rect.size);
    CGContextRef context = UIGraphicsGetCurrentContext();
    
    CGContextSetFillColorWithColor(context, [color CGColor]);
    CGContextFillRect(context, rect);
    
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();
    
    return image;
}



- (void)hideOptionsView {
    
    if (forOptionsView==NO) {
        
        CGFloat currentY = optionsView.frame.origin.y;
        CGFloat height = optionsView.frame.size.height;
        CGFloat screenHeight = [UIScreen mainScreen].bounds.size.height;
        
        if (currentY != screenHeight - height) {
            
            CGFloat x = optionsView.frame.origin.x;
            CGFloat newY = currentY + optionsView.frame.size.height;
            CGFloat width = optionsView.frame.size.width;
            CGRect newFrame = CGRectMake(x, newY, width, height);
            
            [UIView animateWithDuration:0.5 animations:^{
                optionsView.frame = newFrame;
            }];
        }
    }
    forOptionsView = YES;
    isOptionsViewHidden = YES;
}

- (void)loadVideoInPlayerAtIndex:(NSInteger)index {
    
    indexBackup = index;
    
    
    if (libraryRecordOpenViewBool==YES) {
        
        [UIView animateWithDuration:0.5 animations:^{
            libraryRecordOpenView.frame = CGRectMake(0, 650, 300, 80);
        }];
        
        libraryRecordOpenViewBool=NO;
        
        [UIView animateWithDuration:0.5 animations:^{
            //[self.navigationController.navigationBar setHidden:NO];
            
            optionsView.frame = CGRectMake(35, 583, 250, 51);
        }];
        
        hideOptionView = NO;
        
    }
    else{
        if (!deleteCellWhileProcessing) {
            NSMutableArray *avPlayers = [[NSMutableArray alloc] init];
            
            for (NSURL *url in videoURLArray)
            {
                AVPlayer *player = [AVPlayer playerWithURL:url];
                [avPlayers addObject:player];
            }
            
            // load video
            VideoPlayer *videoPlayerObj = [[VideoPlayer alloc] init];
            videoPlayerObj.videoIndex = index;
            videoPlayerObj.playlist = avPlayers;
            videoPlayerObj.highlightNames = collect;
            
            [self presentViewController:videoPlayerObj animated:YES completion:nil];
            
            
        }
        
        else{
            
            UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"App is processing a highlight" delegate:self cancelButtonTitle:@"Ok" otherButtonTitles:nil, nil];
            alert.tag=2;
            [alert show];
            
        }
    }
}

// document directory
- (void)addVideoWithURL:(NSURL *)url title:(NSString *)title {
    
    [self getDocDirContent];
    
    
    //    if (!collect) {
    //        collect = [[NSMutableArray alloc] init];
    //    }
    //    if (!cellImagesArray) {
    //        cellImagesArray = [[NSMutableArray alloc] init];
    //    }
    //    if (!videoURLArray) {
    //        videoURL Array = [[NSMutableArray alloc] init];
    //    }
    //
    //    [collect addObject:title];
    //    [videoURLArray addObject:url];
    //    UIImage *thumb = [ViewTab getThumbnailForVideoAtURL:url];
    //    [cellImagesArray addObject:thumb];
    
    
    //[self getDocDirContent];
    //    dispatch_async(dispatch_get_main_queue(), ^{
    
    //    });
    //    [self performSelectorOnMainThread:@selector() withObject:nil waitUntilDone:YES];
    
    deleteCellWhileProcessing = NO;
    [edit setEnabled:YES];
    
}

+ (UIImage *)getThumbnailForVideoAtURL:(NSURL *)videoURL {
    
    AVURLAsset *asset = [[AVURLAsset alloc] initWithURL:videoURL options:nil];
    AVAssetImageGenerator *assetImg = [[AVAssetImageGenerator alloc] initWithAsset:asset];
    CMTime time = CMTimeMakeWithSeconds(1, 1);
    NSError *error;
    CGImageRef imgRef = [assetImg copyCGImageAtTime:time actualTime:nil error:&error];
    
    if (error) {
        UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"Error" message:error.localizedDescription delegate:nil cancelButtonTitle:@"OK" otherButtonTitles:nil];
        [alert show];
        return nil;
    }
    else {
        UIImage *img = [[UIImage alloc] initWithCGImage:imgRef];
        //        NSLog(@"%@", NSStringFromCGSize(img.size));
        return img;
    }
}

- (UIButton *)getAddButtonWithFrame:(CGRect)frame {
    btn = [UIButton buttonWithType:UIButtonTypeCustom];
    btn.frame = frame;
    btn.backgroundColor = [UIColor colorWithWhite:0.0 alpha:1.0];
    btn.titleLabel.textAlignment = NSTextAlignmentCenter;
    btn.titleLabel.numberOfLines = 0;
    btn.titleLabel.lineBreakMode = NSLineBreakByWordWrapping;
    
    if (!_GlobalIsProcessing) {
        //        btn.titleLabel.font = SET_FONT(VERLAG_LIGHT, 25.0);
        [right setEnabled:YES];
        
        NSMutableAttributedString *mAttr = [[NSMutableAttributedString alloc] initWithString:@"\n+\n\n Add Highlight"];
        
        [mAttr addAttributes:@{NSForegroundColorAttributeName: [UIColor whiteColor],
                               NSFontAttributeName: SET_FONT(VERLAG_LIGHT, 40.0)} range:NSMakeRange(0, 2)];
        
        [mAttr addAttributes:@{NSForegroundColorAttributeName:[UIColor whiteColor],
                               NSFontAttributeName: SET_FONT(VERLAG_LIGHT, 15.0)} range:NSMakeRange(2, 16)];
        
        
        //        NSMutableAttributedString *mAttr = [[NSMutableAttributedString alloc] initWithString:@"Add Highlight"];
        //        [mAttr addAttributes:@{NSForegroundColorAttributeName:[UIColor whiteColor],NSFontAttributeName: SET_FONT(VERLAG_LIGHT, 20.0)} range:NSMakeRange(0, 13)];
        [btn setAttributedTitle:mAttr forState:UIControlStateNormal];
        
        
    }
    
    else {
        
        
        NSMutableAttributedString *mAttr = [[NSMutableAttributedString alloc] initWithString:[NSString stringWithFormat:@"\n\n%@ is being processed", currentHighlight]];
        NSLog(@"currentHighlight--->%@",currentHighlight);
        
        [mAttr addAttributes:@{NSForegroundColorAttributeName: [UIColor whiteColor],
                               NSFontAttributeName: SET_FONT(VERLAG_LIGHT, 20.0)} range:NSMakeRange(0, currentHighlight.length+21)];
        
        // [btn setAttributedTitle:mAttr forState:UIControlStateNormal];
        
        
        NSLog(@"%@",self.seleltedVideoURLmArray);
        NSLog(@"%@",seleltedImageURLmArray);
        
        statusView.hidden=YES;
        
        
        //  [act startAnimating];
    }
    [btn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
    [btn addTarget:self action:@selector(addNewHighlightButtonTapped:) forControlEvents:UIControlEventTouchUpInside];
    
    return btn;
}



-(CGRect)getAddViewFrame {
    
    if (viewTabCollectionFlow.scrollDirection == UICollectionViewScrollDirectionHorizontal) {
        
        if([[UIDevice currentDevice]userInterfaceIdiom]==UIUserInterfaceIdiomPhone)
        {
            // 4
            if ([[UIScreen mainScreen] bounds].size.height == 480.0f)
            {
                return CGRectMake(0, 0, 159.27, 142);
            }
            
            // 5
            else
            {
                return CGRectMake(0, 0, 159.27, 171);
            }
        }
    }
    
    else {
        return CGRectMake(0, 0, 159.27, 171);
    }
    return CGRectMake(0, 0, 157, 151);
}

- (NSString *)stringFromTimeInterval:(double)interval {
    NSInteger ti = (NSInteger)interval;
    NSInteger seconds = ti % 60;
    NSInteger minutes = (ti / 60) % 60;
    NSInteger hours = (ti / 3600);
    if (hours) {
        return [NSString stringWithFormat:@"%02ld:%02ld:%02ld", (long)hours, (long)minutes, (long)seconds];
    }
    else {
        return [NSString stringWithFormat:@"%02ld:%02ld", (long)minutes, (long)seconds];
    }
}

- (void)hideContextMenu {
    
    if (contextMenu) {
        [contextMenu removeFromSuperview];
        contextMenu = nil;
    }
}

- (void)getSearchResultsForQuery:(NSString *)query {
    
    [highlightNameMatchesArray removeAllObjects];
    [cellImagesMatchesArray removeAllObjects];
    [videoURLMatchesArray removeAllObjects];
    //  [highlightNamesArray insertObject:@"a" atIndex:0];
    if (query) {
        
        if (query.length > 0) {
            
            for (NSString *name in highlightNamesArray) {
                if ([name.lowercaseString hasPrefix:query.lowercaseString]) {
                    
                    NSInteger index = [highlightNamesArray indexOfObject:name];
                    [highlightNameMatchesArray addObject:name];
                    [cellImagesMatchesArray addObject:[cellImagesArray objectAtIndex:index]];
                    [videoURLMatchesArray addObject:[videoURLArray objectAtIndex:index]];
                }
            }
        }
        else
        {
            for (NSString *name in highlightNamesArray) {
                
                NSInteger index = [highlightNamesArray indexOfObject:name];
                [highlightNameMatchesArray addObject:name ];
                [cellImagesMatchesArray addObject:[cellImagesArray objectAtIndex:index]];
                [videoURLMatchesArray addObject:[videoURLArray objectAtIndex:index]];
                
                
            }
            
        }
    }
    
    [self gridViewButtonTapped:@"sender"];
    
    //[highlightNamesArray removeObjectAtIndex:0];
}

- (void)searchCancelButtonPressed:(id)sender {
    
    [highlightNameMatchesArray removeAllObjects];
    [cellImagesMatchesArray removeAllObjects];
    [videoURLMatchesArray removeAllObjects];
    
    [highlightNameMatchesArray addObjectsFromArray:highlightNamesArray];
    [cellImagesMatchesArray addObjectsFromArray:cellImagesArray];
    [videoURLMatchesArray addObjectsFromArray:videoURLArray];
    
    [viewTabCollectionView reloadData];
    [searchTextField setText:nil];
    [self showSearchButtonOnRight];
}


#pragma mark - IBActions

- (void)menuButtonTapped:(id)sender
{
    settingViewController *objectSettibgViewController = [[settingViewController alloc] init];
    objectSettibgViewController.delegate = self;
    [self presentViewController:objectSettibgViewController animated:YES completion:nil];
}

- (void)searchButtonTapped:(id)sender {
    [self showTextFieldSearchOnRight];
}

- (IBAction)gridViewButtonTapped:(id)sender {
    gridView = YES;
    swipeView = NO;
    scrollView = NO;
    [UIView animateWithDuration:3.0 animations:^{
        [viewTabCollectionFlow setScrollDirection:UICollectionViewScrollDirectionVertical];
        viewTabCollectionView.initialCellTransformBlock = ADLivelyTransformGrow;
        [self.view setTranslatesAutoresizingMaskIntoConstraints:NO];
        //[viewTabCollectionView setTranslatesAutoresizingMaskIntoConstraints:NO];
        //[viewTabCollectionView setNeedsUpdateConstraints];
        
        [viewTabCollectionView setPagingEnabled:NO];
        [viewTabCollectionView reloadData];
    }];
    
    [UIView animateWithDuration:0.5 animations:^{
        
        GoTop.transform=CGAffineTransformMakeRotation(0);
        
    }];
    
    
    // [self hideOptionsView];
    [self showOptionsView];
    
}
- (IBAction)swipViewButtonTapped:(id)sender {
    gridView = NO;
    swipeView = YES;
    scrollView = NO;
    [UIView animateWithDuration:3.0 animations:^{
        [viewTabCollectionFlow setScrollDirection:UICollectionViewScrollDirectionHorizontal];
        viewTabCollectionView.initialCellTransformBlock = ADLivelyTransformGrow;
        [viewTabCollectionView setPagingEnabled:NO];
        // [viewTabCollectionView setTranslatesAutoresizingMaskIntoConstraints:NO];
        [self.view setTranslatesAutoresizingMaskIntoConstraints:NO];
        //[viewTabCollectionView setTranslatesAutoresizingMaskIntoConstraints:NO];
        //[viewTabCollectionView setNeedsUpdateConstraints];
        
        
        [viewTabCollectionView reloadData];
    }];
    
    
    [UIView animateWithDuration:0.5 animations:^{
        
        GoTop.transform=CGAffineTransformMakeRotation(-1.6);
        
    }];
    
    
    // [self hideOptionsView];
    [self showOptionsView];
    
}

- (IBAction)scrollViewButtonTapped:(id)sender {
    //viewTabCollectionFlow.scrollDirection = UICollectionViewScrollDirectionVertical;
    
    gridView = NO;
    swipeView = NO;
    scrollView = YES;
    
    [UIView animateWithDuration:3.0 animations:^{
        [viewTabCollectionFlow setScrollDirection:UICollectionViewScrollDirectionVertical];
        viewTabCollectionView.initialCellTransformBlock = ADLivelyTransformGrow;
        [self.view setTranslatesAutoresizingMaskIntoConstraints:NO];
        //[viewTabCollectionView setTranslatesAutoresizingMaskIntoConstraints:NO];
        //[viewTabCollectionView setNeedsUpdateConstraints];
        
        [viewTabCollectionView setPagingEnabled:NO];
        [viewTabCollectionView reloadData];
    }];
    
    
    [UIView animateWithDuration:0.5 animations:^{
        
        GoTop.transform=CGAffineTransformMakeRotation(-1.6);
        
    }];
    
    //    [viewTabCollectionView setPagingEnabled:YES];
    // [self hideOptionsView];
    [self showOptionsView];
}

- (void)addNewHighlightButtonTapped:(id)sender {
    
    
    if (contextMenu) {
        [self hideContextMenu];
    }
    
    if (!_GlobalIsProcessing) {
        
        
        if (![[[NSUserDefaults standardUserDefaults]valueForKey:@"login"] isEqualToString:@"loginSeAyaMai"] && highlightNameMatchesArray.count >= 3) {
            
            UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"You can make only 3 highlights to make more highlights please register" delegate:self cancelButtonTitle:@"Cancel" otherButtonTitles:@"Register", nil];
            alert.tag=1;
            [alert show];
            
        }
        else
        {
            //            [self.navigationController presentPopinController:addHighlightOptionsObject animated:YES completion:nil];
            [UIView animateWithDuration:0.5 animations:^{
                
                libraryRecordOpenViewBool=YES;
                
                libraryRecordOpenView.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.5];
                libraryRecordOpenView.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
                
                libraryRecordOpenView.frame = CGRectMake(0, 244, 320, 80);
            }];
            
            
            
        }
        
    }
}


- (IBAction)libraryButtonTapped:(id)sender {
    
    LibraryTab *object = (LibraryTab *)[MainScreenWireframe getLibraryTabObject];
    [object hideCancelDoneView:NO];
    [MainScreenWireframe getMainScreenWireframe].selectedIndex = 0;
    [self.presentingPopinViewController dismissCurrentPopinControllerAnimated:NO completion:^{
        //--SURAJ[Tab Bar Hide Kiya]-----//
        LeveyTabBarController *tabBCC = [MainScreenWireframe getMainScreenWireframe];
        
        if (!tabBCC.tabBarHidden) {
            [tabBCC hidesTabBar:YES animated:YES];
            
        }
        else
        {
            NSLog(@"NahiJama");
        }
        
    }];
    
}
- (IBAction)recordButtonTapped:(id)sender {
    [MainScreenWireframe getMainScreenWireframe].selectedIndex = 2;
    [self.presentingViewController dismissCurrentPopinControllerAnimated:NO completion:nil];
}




- (void)highlightoptionPressed:(UILongPressGestureRecognizer *)longPress {
    
    
    if (longPress.state == UIGestureRecognizerStateBegan) {
        ViewCustomCell *view = (ViewCustomCell *)longPress.view;
        
        if (![view.contentView.subviews containsObject:_GlobalInfoButton]) {
            selectedIndex = (NSUInteger)view.tag;
            
            if (processingStatusView == YES )
            {
                // selectedIndex = selectedIndex +1;
            }
            
            
            if (contextMenu) {
                [self hideContextMenu];
            }
            
            if (!contextMenu) {
                contextMenu = [self getContextMenu];
                [view.contentView addSubview:contextMenu];
                
                NSLog(@"%f", self.navigationController.navigationBar.alpha);
                if (self.navigationController.navigationBar.alpha != 0.0) {
                    
                    [UIView animateWithDuration:0.7 animations:^{
                        self.navigationController.navigationBar.alpha = 0.0;
                    }];
                }
            }
        }
    }
}

- (void)contextMenuBkgndTapped:(UITapGestureRecognizer *)tap {
    
    //    UIView *view = tap.view;
    //    [view removeFromSuperview];
    
    [self hideContextMenu];
    
    [UIView animateWithDuration:0.7 animations:^{
        self.navigationController.navigationBar.alpha = 1.0;
    }];
}

- (void)tapOnBackgroundRecognized {
    
    if (contextMenu) {
        [self hideContextMenu];
    }
    
    [UIView animateWithDuration:0.5 animations:^{
        libraryRecordOpenView.frame = CGRectMake(0, 650, 300, 80);
    }];
    
    [UIView animateWithDuration:0.5 animations:^{
        optionsView.frame = CGRectMake(0, 585, 320, 150);
    }];
    
    [UIView animateWithDuration:0.7 animations:^{
        self.navigationController.navigationBar.alpha = 1.0;
    }];
    [UIView animateWithDuration:0.4 animations:^{
        LeveyTabBarController *tabBCC = [MainScreenWireframe getMainScreenWireframe];
        
        if (tabBCC.tabBarHidden)
        {
            [tabBCC hidesTabBar:NO animated:YES];
            
        }
        else
        {
            NSLog(@"NahiJama");
        }
    }];
    
    
}

-(void)doubleTapOnCell
{
    NSLog(@"Double tapped");
    if (deleteCellWhileProcessing)
    {
        VideoThumnailVCPopUp *thumbNailPopUp = [[VideoThumnailVCPopUp alloc]init];
        [thumbNailPopUp setVideoThumbnailIndex:selectedThumbnailIndex + 1];
        
        [self presentPopinController:thumbNailPopUp animated:YES completion:nil];
        
    }
    else
    {
        VideoThumnailVCPopUp *thumbNailPopUp = [[VideoThumnailVCPopUp alloc]init];
        [thumbNailPopUp setVideoThumbnailIndex:selectedThumbnailIndex];
        
        [self presentPopinController:thumbNailPopUp animated:YES completion:nil];
        
    }
}

- (void)doneButtonPressed:(id)sender {
    searchTextField.text = nil;
    [searchTextField resignFirstResponder];
}

- (IBAction)textFieldTextDidChange:(id)sender {
    
    UITextField *textField = (UITextField *)sender;
    NSString *query = textField.text;
    [self getSearchResultsForQuery:query];
}


#pragma mark - RNFrostedSidebarDelegate

- (void)sidebar:(RNFrostedSidebar *)sidebar didTapItemAtIndex:(NSUInteger)index {
    NSLog(@"Tapped item at index %lu",(unsigned long)index);
    if(index==0){
        NSString *key=[[NSUserDefaults standardUserDefaults] objectForKey:@"login"];
        if ([key isEqualToString:@"facebookSeAyaMai"])
        {
            UIActionSheet *logOut = [[UIActionSheet alloc]initWithTitle:@"Are you sure you want to logout?" delegate:self cancelButtonTitle:@"Cancel" destructiveButtonTitle:@"Log Out Facebook" otherButtonTitles:nil, nil];
            [logOut showFromTabBar:self.tabBarController.tabBar];
            
            
            
        }
        if ([key isEqualToString:@"loginSeAyaMai"])
        {
            UIActionSheet *logOut = [[UIActionSheet alloc]initWithTitle:@"Are you sure you want to logout?" delegate:self cancelButtonTitle:@"Cancel" destructiveButtonTitle:@"Log Out" otherButtonTitles:nil, nil];
            [logOut showFromTabBar:self.tabBarController.tabBar];
            
            //        [[NSUserDefaults standardUserDefaults] setValue:@"" forKey:@"email"];
            //        [[NSUserDefaults standardUserDefaults] setValue:@"" forKey:@"password"];
            //        [[NSUserDefaults standardUserDefaults] synchronize];
            
        }
        if ([key isEqualToString:@"tryAsGuestSeAyaMai"])
        {
            UIActionSheet *logOut = [[UIActionSheet alloc]initWithTitle:@"Are you sure you want to logout?" delegate:self cancelButtonTitle:@"Cancel" destructiveButtonTitle:@"Register" otherButtonTitles:nil, nil];
            [logOut showFromTabBar:self.tabBarController.tabBar];
            //[self presentViewController:tabBC animated:YES completion:nil];
            
            
            
        }
    }
    if(index==1){
        
        NSString *key=[[NSUserDefaults standardUserDefaults] objectForKey:@"login"];
        if ([key isEqualToString:@"loginSeAyaMai"]){
            
            NSString *password=[[NSUserDefaults standardUserDefaults] objectForKey:@"password"];
            NSString *email=[[NSUserDefaults standardUserDefaults] objectForKey:@"email"];
            NSLog(@"%@",email);
            NSLog(@"%@",password);
            
            //            changePassWord.titleLabel.lineBreakMode = NSLineBreakByTruncatingTail;
            //
            //
            //            [self applyCustomisationsForButton:cancelBtn withTitle:@"Cancel"];
            //            [self applyCustomisationsForButton:changePassWord withTitle:@"Change Password"];
            
            NSString *myString = @"   UserName-";
            NSString *myString1 = @"   PassWord-";
            usernameTxt.text=[myString stringByAppendingString:email];
            passwordTxt.text=[myString1 stringByAppendingString:password];
            
            
            [UIView animateWithDuration:0.5 animations:^{
                
                userinfoview.frame = CGRectMake(0, 320, 320, 213);
                
            }];
            
            
            
        }
        
        else{
            
            
            UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"Login throught Try As Guest" delegate:self cancelButtonTitle:@"Ok" otherButtonTitles:nil, nil];
            [alert show];
            
        }
        
        
    }
    
    
    [sidebar dismissAnimated:YES completion:nil];
}

- (void)sidebar:(RNFrostedSidebar *)sidebar didEnable:(BOOL)itemEnabled itemAtIndex:(NSUInteger)index {
    if (itemEnabled) {
        [self.optionIndices addIndex:index];
    }
    else {
        [self.optionIndices removeIndex:index];
    }
    
    
}
#pragma mark - UserInfoView Action

-(IBAction)ChangePasswordView{
    
    [UIView animateWithDuration:0.5 animations:^{
        // [visualEffectView removeFromSuperview];
        userinfoview.frame = CGRectMake(0, 589, 320, 240);
    }];
    
    [UIView animateWithDuration:0.5 animations:^{
        // [visualEffectView removeFromSuperview];
        changePasswordView.frame = CGRectMake(0, 270, 320, 271);
    }];
    
    
}
-(IBAction)cancelPasswordView{
    
    
    [UIView animateWithDuration:0.5 animations:^{
        //[self.navigationController.navigationBar setHidden:NO];
        
        changePasswordView.frame = CGRectMake(0, 589, 320, 240);
    }];
    
}

-(IBAction)cancelUserInfoView{
    
    [UIView animateWithDuration:0.5 animations:^{
        //[self.navigationController.navigationBar setHidden:NO];
        
        userinfoview.frame = CGRectMake(0, 589, 320, 240);
    }];
    
    [UIView animateWithDuration:0.5 animations:^{
        //[self.navigationController.navigationBar setHidden:NO];
        
        changePasswordView.frame = CGRectMake(0, 589, 320, 240);
    }];
    
    
    
}

-(IBAction)doneChangePasswordFuction
{
    
    NSString *password=[[NSUserDefaults standardUserDefaults] objectForKey:@"password"];
    NSString *email=[[NSUserDefaults standardUserDefaults] objectForKey:@"email"];
    
    oldPasawordStore=Oldpassword.text;
    
    newpassStore=newPassword.text;
    ReEntnewPasawordStore=newPasswordRe.text;
    
    NSLog(@"username %@",email);
    NSLog(@"old password %@",password);
    NSLog(@"enter old password %@",oldPasawordStore);
    NSLog(@"enter new password %@",newpassStore);
    NSLog(@"Reenter new password %@",ReEntnewPasawordStore);
    
    
    if (oldPasawordStore.length==0 && newpassStore.length==0 && newpassStore.length==0) {
        
        
        UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"Enter Valid credential" delegate:self cancelButtonTitle:@"Ok" otherButtonTitles:nil, nil];
        [alert show];
        
        
        
    }
    else{
        if ([newpassStore isEqual:ReEntnewPasawordStore])
        {
            
            if ([password isEqual:oldPasawordStore]) {
                
                
                NSString *urlString=[[NSString alloc]initWithFormat:SERVER_ADDRESS_FORGOTPASSWORD_SENDING_REQUEST];
                NSURL *urllink = [NSURL URLWithString:[NSString stringWithFormat:@"%@", urlString]];
                
                NSLog(@"url link-->%@",urllink);
                
                ASIFormDataRequest  *requestForUsernameValidation = [ASIFormDataRequest requestWithURL:urllink];
                
                [requestForUsernameValidation addPostValue:@"change" forKey:@"mode"];
                [requestForUsernameValidation addPostValue:email forKey:@"email"];
                [requestForUsernameValidation addPostValue:newpassStore forKey:@"newPassword"];
                [requestForUsernameValidation setCompletionBlock:^{
                    
                    // NSLog(@"%@",requestForUsernameValidation.responseString);
                    
                    newPassword.text=Nil;
                    Oldpassword.text=Nil;
                    newPasswordRe.text=Nil;
                    
                    
                    UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"Alert" message:@"Your Password has changed" delegate:nil cancelButtonTitle:@"OK" otherButtonTitles:nil];
                    [alert show];
                    
                    [UIView animateWithDuration:0.5 animations:^{
                        // [self.navigationController.navigationBar setHidden:NO];
                        
                        changePasswordView.frame = CGRectMake(0, 589, 320, 240);
                    }];
                    
                    
                    
                    
                }];
                
                [requestForUsernameValidation setFailedBlock:^{
                    
                    
                    
                }];
                
                
                [requestForUsernameValidation startAsynchronous];
                
            }
            else
            {
                
                UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"Re enter password Wrong" delegate:self cancelButtonTitle:@"Ok" otherButtonTitles:nil, nil];
                [alert show];
            }
            
            
        }
        else{
            
            UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"Old Password Wrong" delegate:self cancelButtonTitle:@"Ok" otherButtonTitles:nil, nil];
            [alert show];
            
        }
        
    }
    
}





#pragma mark - UIActionSheetDelegate

-(void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex
{
    if (buttonIndex==0)
    {
        if([[[NSUserDefaults standardUserDefaults] objectForKey:@"autoLoginPerformed"] isEqualToString:@"yes"])
        {
            
            [[NSUserDefaults standardUserDefaults] setObject:@"no" forKey:@"auto_login"];
            Login *ob=[[Login alloc]init];
            [[NSUserDefaults standardUserDefaults]setValue:@"autoLoginSeAayaMain" forKey:@"loginCheck"];
            [self presentViewController:ob animated:YES completion:nil];
            
        }
        else
        {
            [self dismissViewControllerAnimated:YES completion:nil];
        }
        
        [[NSUserDefaults standardUserDefaults]setValue:@"autoLoginSeNahiAayaMain" forKey:@"loginCheck"];
        [[NSUserDefaults standardUserDefaults] synchronize];
        
        FBSession* session = [FBSession activeSession];
        [session closeAndClearTokenInformation];
        [session close];
        [FBSession setActiveSession:nil];
        
        NSHTTPCookieStorage* cookies = [NSHTTPCookieStorage sharedHTTPCookieStorage];
        NSArray* facebookCookies = [cookies cookiesForURL:[NSURL         URLWithString:@"https://facebook.com/"]];
        
        for (NSHTTPCookie* cookie in facebookCookies)
        {
            [cookies deleteCookie:cookie];
            
        }
        //        [[NSUserDefaults standardUserDefaults]setValue:@"no" forKey:@"autoLoginPerformed"];
        //        [[NSUserDefaults standardUserDefaults] synchronize];
    }
}

- (void)applyCustomisationsForButton:(UIButton *)button withTitle:(NSString *)titleString {
    
    UIImage *bkgndImg = [UIImage imageNamed:@"backgroundButton.png"];
    button.backgroundColor = [UIColor clearColor];
    button.titleLabel.font = [UIFont fontWithName:@"Helevetica Neue" size:20];
    [button setBackgroundImage:bkgndImg forState:UIControlStateNormal];
    [button setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
    [button setTitle:titleString forState:UIControlStateNormal];
    
    
}


- (void)applyCustomisationsForLable:(UILabel *)lable withTitle:(NSString *)titleString {
    
    lable.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.3];
    lable.layer.borderColor = COLOR(78.0, 182.0, 96.0, 1.0).CGColor;
    lable.layer.borderWidth = 0.5;
    [lable setFont:[UIFont fontWithName:@"Helevetica Neue" size:20]];
    
    
}
#pragma mark - LeveyTabBarControllerDelegate

- (void)tabBarController:(LeveyTabBarController *)tabBarController didLongPressViewController:(UIViewController *)viewController
{
    
    if (forOptionsView)
    {
        [self showOptionsView];
        forOptionsView=NO;
    }
    else
    {
        // [self hideOptionsView];
        [self showOptionsView];
    }
    
}




#pragma mark - UICollectionview Data Source & Delegate


-(NSInteger)numberOfSectionsInCollectionView:(UICollectionView *)collectionView {
    return 1;
}

-(NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section {
    
    
    //    if (processingStatusView==YES) {
    //        // return highlightNameMatchesArray.count+1;
    //        return highlightNameMatchesArray.count+1;
    //
    //
    //    }
    //
    if (!_GlobalIsProcessing) {
        // return highlightNameMatchesArray.count+1;
        return highlightNameMatchesArray.count+1;
        
        
    }
    return highlightNameMatchesArray.count+1;
    
}


//- (void)scrollViewDidScroll:(UIScrollView *)scrollView{
//
//
//    NSLog(@"print scroll position of scroll view %f %f",scrollView.contentOffset.x,scrollView.contentOffset.y);
//
//    if (scrollView.contentOffset.y>100.00) {
//
//        statusView.hidden=YES;
//
//    }
//
//    if (scrollView.contentOffset.y<150.000) {
//
//        statusView.hidden=NO;
//
//    }
//
//
//
//}

-(UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath {
    
    
    cell = (ViewCustomCell *)[collectionView dequeueReusableCellWithReuseIdentifier:@"CELL" forIndexPath:indexPath];
    
    
    
    //    if(processingStatusView==YES)
    //    {
    //        //cell.backgroundColor = [UIColor blackColor];
    //        [cell addSubview:statusView];
    processingStatusView = NO;
    
    //}
    //    else{
    
    UILongPressGestureRecognizer *longPress = [[UILongPressGestureRecognizer alloc] initWithTarget:self action:@selector(highlightLongPressed:)];
    longPress.minimumPressDuration = 0.3;
    [cell addGestureRecognizer:longPress];
    
    
    if ([highlightNameMatchesArray containsObject:indexPath]) {
        
    }
    else {
        [self hideContextMenu];
    }
    
    // remove previously added btn
    for (UIView *view in cell.contentView.subviews) {
        if ([view isKindOfClass:[UIButton class]]) {
            [view removeFromSuperview];
        }
        
        if ([view isKindOfClass:[UIVisualEffectView class]]) {
            [view removeFromSuperview];
        }
    }
    
    
    // add button for zeroth index
    if (indexPath.row == 0)
    {
        if (!deleteCellWhileProcessing) {
            _GlobalInfoButton = [self getAddButtonWithFrame:[self getAddViewFrame]];
            
            if (scrollView)
            {
                
                
                [_GlobalInfoButton setFrame:CGRectMake(0, 0, 320, 151)];
                UIImage *statusViewBGImage = [UIImage imageNamed:@"AddHighlightBG.png"];
                [_GlobalInfoButton setBackgroundImage:statusViewBGImage forState:UIControlStateNormal];
                
                
            }
            else if(swipeView){
                
                [_GlobalInfoButton setFrame:CGRectMake(0, 0,  159.27, 151)];
                UIImage *statusViewBGImage = [UIImage imageNamed:@"AddHighlightBG.png"];
                //UIImageView *statusViewBGImageView =[[UIImageView alloc] initWithImage:statusViewBGImage];
                [_GlobalInfoButton setBackgroundImage:statusViewBGImage forState:UIControlStateNormal];
                
                
            }
            else
            {
                [_GlobalInfoButton setFrame:CGRectMake(0, 0,  159.27, 151)];
                UIImage *statusViewBGImage = [UIImage imageNamed:@"AddHighlightBG.png"];
                //UIImageView *statusViewBGImageView =[[UIImageView alloc] initWithImage:statusViewBGImage];
                [_GlobalInfoButton setBackgroundImage:statusViewBGImage forState:UIControlStateNormal];
                
            }
            
            [cell.contentView addSubview:_GlobalInfoButton];
        }
        else
        {
            if (scrollView)
            {
                [_GlobalInfoButton setFrame:CGRectMake(0, 0, 320, 151)];
                [statusView setFrame:CGRectMake(0, 0, 320, 151)];
                [_GlobalInfoButton addSubview:statusView];
                [moviePlayerController.view setFrame:statusView.bounds];  // player's frame must match parent's
                
                
                
            }
            else if(swipeView){
                
                [_GlobalInfoButton setFrame:CGRectMake(0, 0,  159.27, 165)];
                [statusView setFrame:CGRectMake(0, 0,  159.27, 165)];
                [_GlobalInfoButton addSubview:statusView];
                [moviePlayerController.view setFrame:statusView.bounds];  // player's frame
                
            }
            else
            {
                [statusView setFrame:CGRectMake(0, 0, 320, 151)];
                [_GlobalInfoButton setFrame:CGRectMake(0, 0,  320, 151)];
                
                [_GlobalInfoButton addSubview:statusView];
                [moviePlayerController.view setFrame:statusView.bounds];  // player's frame must match parent'
                
                
            }
            
            
            [cell.contentView addSubview:_GlobalInfoButton];
            
        }
        
        
    }
    else {
        
        cell.videoHighlightLabel.text = [highlightNameMatchesArray objectAtIndex:indexPath.row-1];
        cell.videoHighlightImage.image = [cellImagesMatchesArray objectAtIndex:indexPath.row-1];
        
        // videoURLArray
        NSLog(@"%lu",(unsigned long)[videoURLMatchesArray count]);
        NSURL *currentURL = [videoURLMatchesArray objectAtIndex:indexPath.row-1];
        NSLog(@"%@",videoURLMatchesArray);
        AVURLAsset *asset = [[AVURLAsset alloc] initWithURL:currentURL options:nil];
        CMTime time = asset.duration;
        double timeSec = (double)time.value/time.timescale;
        NSString *timeString = [self stringFromTimeInterval:timeSec];
        cell.videoDurationLabel.text = timeString;
        
        cell.tag = indexPath.row-1;
        
        //            if ([[highlightNameMatchesArray objectAtIndex:indexPath.row] isEqualToString:@"QikViewLogo"])
        //            {
        //
        //            }
        //            else
        //            {
        //                cell.videoHighlightLabel.text = [highlightNameMatchesArray objectAtIndex:indexPath.row];
        //                cell.videoHighlightImage.image = [cellImagesMatchesArray objectAtIndex:indexPath.row];
        //
        //                // videoURLArray
        //                NSLog(@"%lu",(unsigned long)[videoURLMatchesArray count]);
        //                NSURL *currentURL = [videoURLMatchesArray objectAtIndex:indexPath.row];
        //                NSLog(@"%@",videoURLMatchesArray);
        //                AVURLAsset *asset = [[AVURLAsset alloc] initWithURL:currentURL options:nil];
        //                CMTime time = asset.duration;
        //                double timeSec = (double)time.value/time.timescale;
        //                NSString *timeString = [self stringFromTimeInterval:timeSec];
        //                cell.videoDurationLabel.text = timeString;
        //                cell.tag = indexPath.row;
        //                //NSLog(@"print %ld",(long)indexPath.row);
        //
        //            }
    }
    
    //}
    
    return cell;
    
    
}

- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath
{
    
    playSearchVideoIndex = indexPath.row;
    
    
}

- (IBAction)TapOnCell:(id)sender
{
    
    NSLog(@"%@",sender);
    
    [self createCustomVideoPlayerView];
    
}
-(void)createCustomVideoPlayerView
{
    // CGPoint tappedPoint = [sender locationInView:viewTabCollectionView];
    
    NSIndexPath *tappedCellPath;
    tappedCellPath = [NSIndexPath indexPathWithIndex:playSearchVideoIndex];
    tappedCellPath=   [NSIndexPath indexPathForRow:playSearchVideoIndex inSection:0];
    if (tappedCellPath)
    {
        cell = (ViewCustomCell *)[viewTabCollectionView cellForItemAtIndexPath:tappedCellPath];
        //[viewTabCollectionView selectItemAtIndexPath:tappedCellPath animated:YES scrollPosition:UICollectionViewScrollPositionNone];
        
        int i =  (int)[highlightNamesArray indexOfObject:[[cell valueForKey:@"videoHighlightLabel"] valueForKey:@"text"]];
        // [self hideOptionsView];
        [self showOptionsView];
        [self loadVideoInPlayerAtIndex:i];
    }
    
    ////
    
}
- (IBAction)DoubleTap:(id)sender
{
    
    if (!deleteCellWhileProcessing) {
        
        
        
        // NSLog(@"print sender------->%@",sender);
        CGPoint tappedPoint = [sender locationInView:viewTabCollectionView];
        // NSLog(@"print sender------->%f   %f",tappedPoint.x,tappedPoint.y);
        
        NSIndexPath *tappedCellPath = [viewTabCollectionView indexPathForItemAtPoint:tappedPoint];
        if (deleteCellWhileProcessing)
        {
            playSearchVideoIndex =  playSearchVideoIndex -1;
        }
        else
        {
            // playSearchVideoIndex =   playSearchVideoIndex;
        }
        //  NSIndexPath *tappedCellPath = [viewTabCollectionView cellForItemAtIndexPath:thIndex:playSearchVideoIndex];
        
        if(tappedCellPath.row != 0)
        {
            if (tappedCellPath)
            {
                //        cell = (ViewCustomCell *)[viewTabCollectionView cellForItemAtIndexPath:tappedCellPath];
                tappedCellPath=   [NSIndexPath indexPathForRow:playSearchVideoIndex inSection:0];
                
                cell = (ViewCustomCell *)[viewTabCollectionView cellForItemAtIndexPath:tappedCellPath];
                
                [viewTabCollectionView selectItemAtIndexPath:tappedCellPath animated:YES scrollPosition:UICollectionViewScrollPositionNone];
                
                NSLog(@"Double Tapped On Cell......");
                VideoThumnailVCPopUp *thumbNailPopUp = [[VideoThumnailVCPopUp alloc]init];
                //[thumbNailPopUp setVideoThumbnailIndex:tappedCellPath.row-1];
                [thumbNailPopUp setVideoThumbnailIndex:tappedCellPath.row-1];
                
                [self.navigationController presentViewController:thumbNailPopUp animated:YES completion:nil];
                
            }
        }
        
    }
    else{
        
        
        UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"App is processing a highlight" delegate:self cancelButtonTitle:@"Ok" otherButtonTitles:nil, nil];
        alert.tag=2;
        [alert show];
        
    }
}



#pragma mark - CollectionView Flow Layout

- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath {
    
    if (viewTabCollectionFlow.scrollDirection == UICollectionViewScrollDirectionHorizontal)
    {
        
        if([[UIDevice currentDevice]userInterfaceIdiom]==UIUserInterfaceIdiomPhone)
        {
            // 4
            if ([[UIScreen mainScreen] bounds].size.height == 480.0f)
            {
                if (indexPath.row == 0)
                {
                    if (deleteCellWhileProcessing)
                    {
                        return CGSizeMake(159.27, 142);
                    }
                }
                
                return CGSizeMake(159.27, 142);
                
            }
            
            // 5
            else
            {
                if (indexPath.row == 0)
                {
                    if (deleteCellWhileProcessing)
                    {
                        return CGSizeMake(159.27, 151);
                    }
                }
                
                return CGSizeMake(159.27, 151);
                
            }
        }
        
    }
    
    else {
        
        if (gridView)
        {
            if (indexPath.row == 0)
            {
                if (deleteCellWhileProcessing)
                {
                    return CGSizeMake(320, 151);
                }
                
            }
            
            else
            {
                return CGSizeMake(159.27, 151);
                
            }
            
        }
        if (scrollView)
        {
            if (indexPath.row == 0)
            {
                if (deleteCellWhileProcessing)
                {
                    return CGSizeMake(320, 151);
                }
            }
            
            return CGSizeMake(320, 151);
            
        }
        
    }
    
    return CGSizeMake(159.27, 151);
}

- (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout insetForSectionAtIndex:(NSInteger)section{
    return UIEdgeInsetsMake(0, 0, 92, 0);
}

- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section{
    if (collectionView.pagingEnabled == YES) {
        return 0.0;
    }
    else
    {
        return 1.0;
    }
    
}


#pragma mark - UIScrollViewDelegate

- (void)scrollViewWillBeginDragging:(UIScrollView *)scrollView {
    BOOL isScrolling = [scrollView.layer animationForKey: @"bounds"] != nil;
    if (!isScrolling) {
        
        if (hideOptionView)
        {
            
            [UIView animateWithDuration:0.5 animations:^{
                //[self.navigationController.navigationBar setHidden:NO];
                
                optionsView.frame = CGRectMake(35, 583, 250, 51);
            }];
            
            hideOptionView = NO;
        }
        
    }
}


#pragma mark - Context menu methods

- (UIVisualEffectView *)getContextMenu
{
    UIVisualEffect *blurEffect = [UIBlurEffect effectWithStyle:UIBlurEffectStyleLight];
    UIVisualEffectView *contextMenuView = [[UIVisualEffectView alloc] initWithEffect:blurEffect];
    
    if (viewTabCollectionFlow.scrollDirection == UICollectionViewScrollDirectionHorizontal) {
        contextMenuView.frame = CGRectMake(0, 0, 159.27, 171);
    }
    else {
        contextMenuView.frame = CGRectMake(0, 0, 159.27, 151);
    }
    
    UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(contextMenuBkgndTapped:)];
    [contextMenuView addGestureRecognizer:tap];
    
    
    CSAnimationView *animView=[[CSAnimationView alloc] initWithFrame:CGRectMake(0, 8, 69, 136)];
    
    if (viewTabCollectionFlow.scrollDirection == UICollectionViewScrollDirectionHorizontal) {
        animView.frame = CGRectMake(0, 18, 69, 136);
    }
    else {
        animView.frame = CGRectMake(0, 8, 69, 136);
    }
    
    animView.delay=0;
    animView.duration=0.5;
    animView.type=CSAnimationTypePopAlpha;
    [contextMenuView addSubview:animView];
    
    [animView startCanvasAnimation];
    
    
    
    contextMenuBaseImageView = [[UIImageView alloc]initWithFrame:animView.bounds];
    
    [contextMenuBaseImageView setImage:[UIImage imageNamed:@"menuBase.png"]];
    
    contextMenuBaseImageView.userInteractionEnabled=YES;
    
    [animView addSubview:contextMenuBaseImageView];
    
    //    [myView addSubview:animView];
    
    
    
    share=[[UIButton alloc]initWithFrame:CGRectMake(20, 45, 50, 50)];
    
    [share setImage:[UIImage imageNamed:@"menuShare.png"] forState:UIControlStateNormal];
    
    share.showsTouchWhenHighlighted=YES;
    
    [share addTarget:self action:@selector(shareFunction:) forControlEvents:UIControlEventTouchUpInside];
    
    [contextMenuBaseImageView addSubview:share];
    
    
    
    delete=[[UIButton alloc] initWithFrame:CGRectMake(0, 5, 40, 40)];
    
    [delete setImage:[UIImage imageNamed:@"menuDelete.png"] forState:UIControlStateNormal];
    [delete addTarget:self action:@selector(deleteButtonTapped) forControlEvents:UIControlEventTouchUpInside];
    
    [contextMenuBaseImageView addSubview:delete];
    
    
    
    edit=[[UIButton alloc] initWithFrame:CGRectMake(0, 90, 40, 40)];
    
    [edit setImage:[UIImage imageNamed:@"menuEdit.png"] forState:UIControlStateNormal];
    [edit addTarget:self action:@selector(editButtonTapped) forControlEvents:UIControlEventTouchUpInside];
    [contextMenuBaseImageView addSubview:edit];
    
    return contextMenuView;
}

- (void)editButtonTapped{
    
    if (deleteCellWhileProcessing == YES)
    {
        [edit setEnabled:NO];
    }
    else
    {
        EditCellPopUp *objEdit = [[EditCellPopUp alloc]init];
        
        objEdit.videoIndexForNameChange = selectedIndex;
        [objEdit setPopinAlignment:BKTPopinAlignementOptionDown];
        //[objEdit setPopinOptions:BKTPopinDisableAutoDismiss];
        
        [self presentPopinController:objEdit animated:YES completion:^{
            [self hideContextMenu];
            LeveyTabBarController *tabBCC = [MainScreenWireframe getMainScreenWireframe];
            
            if (!tabBCC.tabBarHidden)
            {
                [tabBCC hidesTabBar:YES animated:YES];
                
            }
            else
            {
                NSLog(@"NahiJama");
            }
            
        }];
        
    }
    
    
}
- (void)callDeleteButtonTap
{
    {
        
        selectedIndex = indexBackup;
        
        if (deleteCellWhileProcessing == YES)
        {
            
            NSLog(@"selected index %lu",(unsigned long)indexBackup);
            
            NSString *documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
            NSString *filePath = [documentsPath stringByAppendingPathComponent:@"MyHighlights"];
            NSString *filePath1 = [filePath stringByAppendingPathComponent:[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:selectedIndex]]];
            NSLog(@"%@",[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:selectedIndex]]);
            [self arrayDeleteWhileProcessing];
            [self removeSelectedCell:filePath1];
            NSLog(@"%@",filePath1);
            NSLog(@"sortedDocDirContents--->%@",[sortedDocDirContents objectAtIndex:selectedIndex]);
            NSLog(@"sortedDocDirContents Count--->%lu",(unsigned long) [sortedDocDirContents count]);
            
            [self reloadData];
            //[cell addSubview:statusView];
            
            NSLog(@"%@",filePath1);
            
            
        }
        else
        {
            NSLog(@"selected index %lu",(unsigned long)indexBackup);
            
            
            NSString *documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
            NSString *filePath = [documentsPath stringByAppendingPathComponent:@"MyHighlights"];
            NSString *filePath1 = [filePath stringByAppendingPathComponent:[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:indexBackup]]];
            NSLog(@"%@",[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:indexBackup]]);
            [self arrayDeleteWhenProcessingFinished];
            
            [self removeSelectedCell:filePath1];
            NSLog(@"%@",filePath1);
            NSLog(@"sortedDocDirContents--->%@",[sortedDocDirContents objectAtIndex:indexBackup]);
            
            NSLog(@"sortedDocDirContents Count--->%lu",(unsigned long) [sortedDocDirContents count]);
            
            [self reloadData];
            
            NSLog(@"%@",filePath1);
            
        }
        
        
    }
}
//delete
-(void)deleteButtonTapped{
    
    if (deleteCellWhileProcessing == YES)
    {
        [edit setEnabled:NO];
    }
    else{
        UIAlertView *deleteWarning = [[UIAlertView alloc] initWithTitle:@"Warning" message:@"Are you sure you want to delete" delegate:self cancelButtonTitle:@"Cancel" otherButtonTitles:@"Delete", nil];
        [deleteWarning show];
    }
    
}


- (void)removeSelectedCell:(NSString *)selectedCell
{
    NSLog(@"selected cell-->%@",selectedCell);
    
    NSFileManager *fileManager = [NSFileManager defaultManager];
    NSError *error;
    BOOL success = [fileManager removeItemAtPath:[NSString stringWithFormat:@"%@",selectedCell] error:&error];
    
    //    if (success) {
    //        UIAlertView *removeSuccessFulAlert=[[UIAlertView alloc]initWithTitle:@"Success" message:@"Video was deleted successfully." delegate:nil cancelButtonTitle:@"Close" otherButtonTitles:nil];
    //
    //
    //        [removeSuccessFulAlert show];
    //    }
    //    else
    //    {
    ////        NSLog(@"Could not delete file -:%@ ",[error localizedDescription]);
    ////        UIAlertView *removeSuccessFulAlert=[[UIAlertView alloc]initWithTitle:@"Error" message:[error localizedDescription] delegate:nil cancelButtonTitle:@"Close" otherButtonTitles:nil];
    //
    //        UIAlertView *removeSuccessFulAlert=[[UIAlertView alloc]initWithTitle:@"Success" message:@"Video was deleted successfully." delegate:nil cancelButtonTitle:@"Close" otherButtonTitles:nil];
    //
    //
    //        [removeSuccessFulAlert show];
    //    }
}

#pragma mark - UIAlertView Delegate

- (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex{
    if (alertView.tag == 1) {
        if (buttonIndex==1) {
            [self dismissViewControllerAnimated:YES completion:nil];
        }
        
    }
    else{
        if (buttonIndex==1) {
            
            
            //  NSLog(@"sortedDocDirContents--->%lu",(unsigned long)[sortedDocDirContents objectAtIndex:selectedIndex-1]);
            if (deleteCellWhileProcessing == YES)
            {
                
                NSLog(@"selected index %lu",(unsigned long)selectedIndex);
                
                NSString *documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
                NSString *filePath = [documentsPath stringByAppendingPathComponent:@"MyHighlights"];
                NSString *filePath1 = [filePath stringByAppendingPathComponent:[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:selectedIndex]]];
                NSLog(@"%@",[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:selectedIndex]]);
                [self arrayDeleteWhileProcessing];
                [self removeSelectedCell:filePath1];
                NSLog(@"%@",filePath1);
                NSLog(@"sortedDocDirContents--->%@",[sortedDocDirContents objectAtIndex:selectedIndex]);
                NSLog(@"sortedDocDirContents Count--->%lu",(unsigned long) [sortedDocDirContents count]);
                
                [self reloadData];
                //[cell addSubview:statusView];
                
                NSLog(@"%@",filePath1);
                
                
            }
            else
            {
                
                
                NSString *documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
                NSString *filePath = [documentsPath stringByAppendingPathComponent:@"MyHighlights"];
                NSString *filePath1 = [filePath stringByAppendingPathComponent:[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:selectedIndex]]];
                NSLog(@"%@",[NSString stringWithFormat:@"%@",[sortedDocDirContents objectAtIndex:selectedIndex]]);
                [self arrayDeleteWhenProcessingFinished];
                
                [self removeSelectedCell:filePath1];
                NSLog(@"%@",filePath1);
                NSLog(@"sortedDocDirContents--->%@",[sortedDocDirContents objectAtIndex:selectedIndex]);
                
                NSLog(@"sortedDocDirContents Count--->%lu",(unsigned long) [sortedDocDirContents count]);
                
                [self reloadData];
                
                NSLog(@"%@",filePath1);
                
            }
            
            
        }
    }
}
-(void)arrayDeleteWhileProcessing
{
    [highlightNameMatchesArray removeObjectAtIndex:selectedIndex];
    [cellImagesMatchesArray removeObjectAtIndex:selectedIndex];
    [videoURLMatchesArray removeObjectAtIndex:selectedIndex];
    [highlightNamesArray removeObjectAtIndex:selectedIndex];
    [viewTabCollectionView reloadData];
    
}
-(void)arrayDeleteWhenProcessingFinished
{
    [highlightNameMatchesArray removeObjectAtIndex:selectedIndex];
    [cellImagesMatchesArray removeObjectAtIndex:selectedIndex];
    [videoURLMatchesArray removeObjectAtIndex:selectedIndex];
    [highlightNamesArray removeObjectAtIndex:selectedIndex];
    [viewTabCollectionView reloadData];
    
    
}


-(void)shareFunction:(id)sender {
    
    
    [contextMenuBaseImageView setFrame:CGRectMake(0, 23, 46, 90)];
    
    [contextMenuBaseImageView setImage:[UIImage imageNamed:@"menuBaseSmall.png"]];
    
    
    
    [share setFrame:CGRectMake(25, 38, 12, 12)];
    
    [share setImage:[UIImage imageNamed:@"menuShareSmall.png"] forState:UIControlStateNormal];
    
    
    
    [delete setFrame:CGRectMake(8, 10, 12, 15)];
    
    [delete setImage:[UIImage imageNamed:@"menuEditSmall.png"] forState:UIControlStateNormal];
    
    
    
    [edit setFrame:CGRectMake(8, 65, 12, 15)];
    
    [edit setImage:[UIImage imageNamed:@"menuDeleteSmall.png"] forState:UIControlStateNormal];
    
    
    
    CSAnimationView *animView1=[[CSAnimationView alloc] initWithFrame:CGRectMake(0, 0, 82, 151)];
    
    if (viewTabCollectionFlow.scrollDirection == UICollectionViewScrollDirectionHorizontal) {
        animView1.frame = CGRectMake(0, 6, 82, 160);
    }
    else {
        animView1.frame = CGRectMake(0, 0, 82, 151);
    }
    
    animView1.delay=0;
    animView1.duration=0.5;
    animView1.type=CSAnimationTypeBounceRight;
    
    
    
    // 151
    UIImageView *menuSocialimageVw=[[UIImageView alloc]initWithFrame:animView1.bounds];
    menuSocialimageVw.contentMode = UIViewContentModeScaleAspectFill;
    menuSocialimageVw.clipsToBounds = YES;
    
    [menuSocialimageVw setImage:[UIImage imageNamed:@"BlueWheel5.png"]];
    
    menuSocialimageVw.userInteractionEnabled=YES;
    [animView1 addSubview:menuSocialimageVw];
    
    
    btnDropBox=[[UIButton alloc]initWithFrame:CGRectMake(3, 3, 25, 25)];
    
    [btnDropBox setImage:[UIImage imageNamed:@"menuDropbox.png"] forState:UIControlStateNormal];
    
    btnDropBox.showsTouchWhenHighlighted=YES;
    
    [btnDropBox addTarget:self action:@selector(dropBoxFunction) forControlEvents:UIControlEventTouchUpInside];
    
    UIButton *btnyoutube=[[UIButton alloc]initWithFrame:CGRectMake(40, 25, 25, 25)];
    
    [btnyoutube setImage:[UIImage imageNamed:@"Youtube.png"] forState:UIControlStateNormal];
    
    [btnyoutube addTarget:self action:@selector(presShareYoutube) forControlEvents:UIControlEventTouchUpInside];
    
    // btnGoogle.showsTouchWhenHighlighted=YES;
    
    
    
    UIButton *btnFacebook=[[UIButton alloc]initWithFrame:CGRectMake(50, 63, 25, 25)];
    
    [btnFacebook setImage:[UIImage imageNamed:@"menuFacebook.png"] forState:UIControlStateNormal];
    
    [btnFacebook addTarget:self action:@selector(presShareFb) forControlEvents:UIControlEventTouchUpInside];
    
    
    UIButton *btnFlicker=[[UIButton alloc]initWithFrame:CGRectMake( 40, 100, 25, 25)];
    
    [btnFlicker setImage:[UIImage imageNamed:@"menuFlickr.png"] forState:UIControlStateNormal];
    
    // [btnFlicker addTarget:self action:@selector(presShareFlickr) forControlEvents:UIControlEventTouchUpInside];
    
    
    UIButton *btnTwitter=[[UIButton alloc]initWithFrame:CGRectMake(3, 125, 25, 25)];
    
    [btnTwitter setImage:[UIImage imageNamed:@"More.png"] forState:UIControlStateNormal];
    
    [btnTwitter addTarget:self action:@selector(presShareMore) forControlEvents:UIControlEventTouchUpInside];
    
    
    btnTwitter.showsTouchWhenHighlighted=YES;
    
    [menuSocialimageVw addSubview:btnDropBox];
    
    [menuSocialimageVw addSubview:btnyoutube];
    
    [menuSocialimageVw addSubview:btnFacebook];
    
    [menuSocialimageVw addSubview:btnTwitter];
    
    [menuSocialimageVw addSubview:btnFlicker];
    
    
    UIButton *btn1 = (UIButton *)sender;
    UIView *view = btn1.superview.superview.superview;
    [view addSubview:animView1];
    
    
    [animView1 startCanvasAnimation];
}

#pragma mark - UITextFieldDelegate

- (void)textFieldDidBeginEditing:(UITextField *)textField{
    
    NSLog(@"atul gawali print--->%@",textField);
    
    
    
}
- (void)textFieldDidEndEditing:(UITextField *)textField{
    
    NSLog(@"atul gawali print---->%@",textField);
    
    
    
    
    
}


-(BOOL)textFieldShouldReturn:(UITextField *)textField {
    
    // searchTextField.text = nil;
    [textField resignFirstResponder];
    //    [self showSearchButtonOnRight];
    //    [highlightNameMatchesArray removeAllObjects];
    //    [cellImagesMatchesArray removeAllObjects];
    //    [videoURLMatchesArray removeAllObjects];
    //
    //    for (NSString *name in highlightNamesArray) {
    //
    //
    //        NSInteger index = [highlightNamesArray indexOfObject:name];
    //        [highlightNameMatchesArray addObject:name];
    //        [cellImagesMatchesArray addObject:[cellImagesArray objectAtIndex:index]];
    //        [videoURLMatchesArray addObject:[videoURLArray objectAtIndex:index]];
    //
    //    }
    //
    //    [viewTabCollectionView reloadData];
    
    
    [self searchCancelButtonPressed:@"sender"];
    
    return YES;
}

-(void)fbButtonPressed
{
    
    //    // Check if the Facebook app is installed and we can present the share dialog
    //    FBLinkShareParams *params = [[FBLinkShareParams alloc] init];
    //    params.link = [NSURL URLWithString:@"https://developers.facebook.com/docs/ios/share/"];
    //
    //    // If the Facebook app is installed and we can present the share dialog
    //    if ([FBDialogs canPresentShareDialogWithParams:params]) {
    //
    //        // Present share dialog
    //        [FBDialogs presentShareDialogWithLink:params.link
    //                                      handler:^(FBAppCall *call, NSDictionary *results, NSError *error) {
    //                                          if(error) {
    //                                              // An error occurred, we need to handle the error
    //                                              // See: https://developers.facebook.com/docs/ios/errors
    //                                              NSLog(@"Error publishing story: %@", error.description);
    //                                          } else {
    //                                              // Success
    //                                              NSLog(@"result %@", results);
    //                                          }
    //                                      }];
    //
    //        // If the Facebook app is NOT installed and we can't present the share dialog
    //    } else {
    //        // FALLBACK: publish just a link using the Feed dialog
    //
    //        // Put together the dialog parameters
    //        NSMutableDictionary *params = [NSMutableDictionary dictionaryWithObjectsAndKeys:
    //                                       @"Sharing Tutorial", @"name",
    //                                       @"Build great social apps and get more installs.", @"caption",
    //                                       @"Allow your users to share stories on Facebook from your app using the iOS SDK.", @"description",
    //                                       @"https://developers.facebook.com/docs/ios/share/", @"link",
    //                                       @"http://i.imgur.com/g3Qc1HN.png", @"picture",
    //                                       nil];
    //
    //        // Show the feed dialog
    //        [FBWebDialogs presentFeedDialogModallyWithSession:nil
    //                                               parameters:params
    //                                                  handler:^(FBWebDialogResult result, NSURL *resultURL, NSError *error) {
    //                                                      if (error) {
    //                                                          // An error occurred, we need to handle the error
    //                                                          // See: https://developers.facebook.com/docs/ios/errors
    //                                                          NSLog(@"Error publishing story: %@", error.description);
    //                                                      } else {
    //                                                          if (result == FBWebDialogResultDialogNotCompleted) {
    //                                                              // User canceled.
    //                                                              NSLog(@"User cancelled.");
    //                                                          } else {
    //                                                              // Handle the publish feed callback
    //                                                              NSDictionary *urlParams = [self parseURLParams:[resultURL query]];
    //
    //                                                              if (![urlParams valueForKey:@"post_id"]) {
    //                                                                  // User canceled.
    //                                                                  NSLog(@"User cancelled.");
    //
    //                                                              } else {
    //                                                                  // User clicked the Share button
    //                                                                  NSString *result = [NSString stringWithFormat: @"Posted story, id: %@", [urlParams valueForKey:@"post_id"]];
    //                                                                  NSLog(@"result %@", result);
    //                                                              }
    //                                                          }
    //                                                      }
    //                                                  }];
    //    }
    
}


// A function for parsing URL parameters returned by the Feed Dialog.
- (NSDictionary*)parseURLParams:(NSString *)query {
    NSArray *pairs = [query componentsSeparatedByString:@"&"];
    NSMutableDictionary *params = [[NSMutableDictionary alloc] init];
    for (NSString *pair in pairs) {
        NSArray *kv = [pair componentsSeparatedByString:@"="];
        NSString *val =
        [kv[1] stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];
        params[kv[0]] = val;
    }
    return params;
}

//ForDropBox-Suraj-->
- (void)restClient:(DBRestClient *)client uploadedFile:(NSString *)destPath
              from:(NSString *)srcPath metadata:(DBMetadata *)metadata
{
    NSLog(@"File uploaded successfully to path: %@", metadata.path);
    
    
    NSFileManager *fileManager = [NSFileManager defaultManager];
    //  NSString *documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
    
    //  NSString *filePath = [documentsPath stringByAppendingPathComponent:fileName];
    NSError *error;
    BOOL success = [fileManager removeItemAtPath:srcPath error:&error];
    if (success) {
        // UIAlertView *removeSuccessFulAlert=[[UIAlertView alloc]initWithTitle:@"Congratulation:" message:@"Successfully removed" delegate:self cancelButtonTitle:@"Close" otherButtonTitles:nil];
        //[removeSuccessFulAlert show];
        NSLog(@"File deleted-:%@ ",[error localizedDescription]);
        
    }
    else
    {
        NSLog(@"Could not delete file -:%@ ",[error localizedDescription]);
    }
    
    
}

- (void)restClient:(DBRestClient *)client uploadFileFailedWithError:(NSError *)error
{
    NSLog(@"File upload failed with error: %@", error);
}

- (void)dropBoxFunction
{
    NSURL *urlToVideoOnHardDisk = [videoURLArray objectAtIndex:selectedIndex];
    urlToShare = [NSString stringWithFormat:@"%@",urlToVideoOnHardDisk];
    //   progressView = [[UCZProgressView alloc] initWithFrame:self.view.bounds];
    //   progressView.translatesAutoresizingMaskIntoConstraints = NO;
    //    [btnDropBox addSubview:progressView];
    
    /* if (![[DBSession sharedSession] isLinked])
     {
     [[DBSession sharedSession] linkFromController:self];
     } else
     {
     [[DBSession sharedSession] unlinkAll];
     [[[UIAlertView alloc]
     initWithTitle:@"Account Unlinked!" message:@"Your dropbox account has been unlinked"
     delegate:nil cancelButtonTitle:@"OK" otherButtonTitles:nil]
     //autorelease]
     show];
     [self updateButtons];
     }*/
    
    
    
    if ([[DBSession sharedSession] isLinked])
    {
        NSString* appKey = @"n0mqistdkohs9se";
        NSString* appSecret = @"x1hz6v7ltbgtfeq";
        
        
        DBSession* session = [[DBSession alloc] initWithAppKey:appKey appSecret:appSecret root:nil];
        [DBSession setSharedSession:session];
        
        _restClient = [[DBRestClient alloc] initWithSession:session];
        _restClient.delegate = self;
        
        NSString *filename = @"QikViewDropBoxVideo.mov";
        NSString *localDir = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES)[0];
        NSString *localPath = [localDir stringByAppendingPathComponent:filename];
        //            NSData *imageData = [NSData dataWithData:UIImagePNGRepresentation([UIImage imageNamed:filename])];
        NSData *videodata = [NSData dataWithContentsOfURL:[NSURL URLWithString:urlToShare]];
        [videodata writeToFile:localPath atomically:YES];
        [_restClient uploadFile:@"QikViewDropBoxVideo.mov" toPath:@"/" withParentRev:nil fromPath:urlToShare];
        
    }
    else
    {
        [[DBSession sharedSession] linkFromController:self];
        
    }
    
    
}

- (void)updateButtons {
    NSString* title = [[DBSession sharedSession] isLinked] ? @"Unlink Dropbox" : @"Link Dropbox";
    [btnDropBox setTitle:title forState:UIControlStateNormal];
    
    self.navigationItem.rightBarButtonItem.enabled = [[DBSession sharedSession] isLinked];
}

//atul
-(void)call
{
    
    if (processingStatusView==YES) {
        
        [[NSUserDefaults standardUserDefaults] setObject:@"1" forKey:@"restriction"];
        
        _GlobalIsProcessing = NO;
        //statusView=[[UIView alloc]initWithFrame:CGRectMake(0, 20, 160, 150)];
        statusView=[[UIView alloc]initWithFrame:CGRectMake(0, 0, 320, 151)];
        [statusView setAutoresizingMask:UIViewAutoresizingFlexibleLeftMargin];
        [statusView setAutoresizingMask:UIViewAutoresizingFlexibleWidth];
        
        if (scrollView)
        {
            [_GlobalInfoButton setFrame:CGRectMake(0, 0, 320, 151)];
            [statusView setFrame:CGRectMake(0, 0, 320, 151)];
            
        }
        if(swipeView){
            
            [_GlobalInfoButton setFrame:CGRectMake(0, 0,  151, 165)];
            [statusView setFrame:CGRectMake(0, 0,  151, 165)];
        }
        if (gridView)
        {
            [_GlobalInfoButton setFrame:CGRectMake(0, 0,  320, 151)];
            [statusView setFrame:CGRectMake(0, 0, 320, 151)];
        }
        
        
        //UIView *videoView = [[UIView alloc]initWithFrame:CGRectMake(36, 63, 248, 221)];
        NSString *moviePath = [[NSBundle mainBundle] pathForResource:@"QikViewAdd" ofType:@"mov"];
        
        //NSString *moviePath = [[NSBundle mainBundle] pathForResource:@"demoVideo" ofType:@"mp4"];
        NSURL *movieURL = [NSURL fileURLWithPath:moviePath];
        moviePlayerController = [[MPMoviePlayerController alloc] initWithContentURL:movieURL];
        [moviePlayerController.view setFrame:statusView.bounds];  // player's frame must match parent's
        [statusView addSubview:moviePlayerController.view];
        moviePlayerController.controlStyle = MPMovieControlStyleNone;
        [moviePlayerController prepareToPlay];
        [moviePlayerController setScalingMode:MPMovieScalingModeAspectFill];
        //[self.view addSubview:statusView];
        
        
        
        //[_GlobalInfoButton addSubview:statusView];
        //  [cell.contentView addSubview:_GlobalInfoButton];
        
        
        [[NSNotificationCenter defaultCenter] addObserver:self
                                                 selector:@selector(moviePlayerDidFinish:)
                                                     name:MPMoviePlayerPlaybackDidFinishNotification
                                                   object:moviePlayerController];
        
        [[NSNotificationCenter defaultCenter] addObserver:self
                                                 selector:@selector(MPMoviePlayerPlaybackStateDidChange:)
                                                     name:MPMoviePlayerPlaybackStateDidChangeNotification
                                                   object:moviePlayerController];
        
        stopVideoTimer = [NSTimer scheduledTimerWithTimeInterval:0.5 target:self selector:@selector(newVideoStop) userInfo:nil repeats:YES];
        
        
        NSTimer *delay = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(playVideoDemo) userInfo:nil repeats:NO];
        [delay fire];
        // [moviePlayerController play];
        
        ///////
        
        //        [highlightNameMatchesArray insertObject:@"QikViewLogo" atIndex:0];
        //        [cellImagesMatchesArray insertObject:@"QikViewLogo.png" atIndex:0];
        //        [videoURLMatchesArray insertObject:@"30769C727052/data/Containers/Data/Application/CF545C72-4065-4037-B457-2694B178E0B5/Documents/MyHighlights/565.mov" atIndex:0];
        //        //[sortedDocDirContents addObject:@"tempObject"];
        
        
        
        //      [viewTabCollectionView reloadInputViews];
        
        deleteCellWhileProcessing = YES;
        
    }
    else{
        
        //statusView.hidden=YES;
        
    }
    
    [self.view setTranslatesAutoresizingMaskIntoConstraints:NO];
    [self gridViewButtonTapped:nil];
    //[viewTabCollectionView reloadData];
    // [viewTabCollectionView reloadInputViews];
    [self.view setNeedsDisplay];
    [self.view setNeedsUpdateConstraints];
}
-(void)newVideoStop
{
    if (!deleteCellWhileProcessing)
    {
        [moviePlayerController stop];
        [stopVideoTimer invalidate];
    }
}
- (void)moviePlayerDidFinish:(NSNotification *)note
{
    if (note.object == moviePlayerController) {
        NSInteger reason = [[note.userInfo objectForKey:MPMoviePlayerPlaybackDidFinishReasonUserInfoKey] integerValue];
        if (reason == MPMovieFinishReasonPlaybackEnded)
        {
            if (deleteCellWhileProcessing)
            {
                NSString *moviePath;
                
                int randNo = arc4random()%4;
                
                switch (randNo)
                {
                    case 0:
                        //stst
                        moviePath= [[NSBundle mainBundle] pathForResource:@"QikViewAdd" ofType:@"mov"];
                        
                        break;
                        
                    case 1:
                        //stst
                        moviePath= [[NSBundle mainBundle] pathForResource:@"demoVideo" ofType:@"mp4"];
                        
                        break;
                        
                    case 2:
                        //stst
                        moviePath= [[NSBundle mainBundle] pathForResource:@"QikViewAdd" ofType:@"mov"];
                        
                        break;
                        
                    case 3:
                        //stst
                        moviePath= [[NSBundle mainBundle] pathForResource:@"QikViewAdd" ofType:@"mov"];
                        
                        break;
                        
                        
                    default:
                        break;
                }
                
                NSURL *movieURL = [NSURL fileURLWithPath:moviePath];
                [moviePlayerController setContentURL:movieURL];
                [moviePlayerController play];
                //  check if statusView is not present
                
            }
            else
            {
                [moviePlayerController stop];
            }
        }
    }
}

-(void)playVideoDemo
{
    [moviePlayerController play];
    
}

- (void)MPMoviePlayerPlaybackStateDidChange:(NSNotification *)notification
{
    if (moviePlayerController.playbackState == MPMoviePlaybackStatePlaying)
    {
        //playing
        if (deleteCellWhileProcessing)
        {
            //[moviePlayerController play];
            //  check if statusView is not present
        }
        else
        {
            [moviePlayerController stop];
        }
    }
    if (moviePlayerController.playbackState == MPMoviePlaybackStateStopped)
    { //stopped
    }if (moviePlayerController.playbackState == MPMoviePlaybackStatePaused)
    { //paused
    }if (moviePlayerController.playbackState == MPMoviePlaybackStateInterrupted)
    { //interrupted
    }if (moviePlayerController.playbackState == MPMoviePlaybackStateSeekingForward)
    { //seeking forward
    }if (moviePlayerController.playbackState == MPMoviePlaybackStateSeekingBackward)
    { //seeking backward
    }
    
}

#pragma mark - Reload Collection View For/After Search
-(void)reloadCollectionViewwrtSearch
{
    searchTextField.text = nil;
    [self showSearchButtonOnRight];
    [highlightNameMatchesArray removeAllObjects];
    [cellImagesMatchesArray removeAllObjects];
    [videoURLMatchesArray removeAllObjects];
    
    for (NSString *name in highlightNamesArray) {
        
        
        NSInteger index = [highlightNamesArray indexOfObject:name];
        [highlightNameMatchesArray addObject:name];
        [cellImagesMatchesArray addObject:[cellImagesArray objectAtIndex:index]];
        [videoURLMatchesArray addObject:[videoURLArray objectAtIndex:index]];
        
    }
    
    [viewTabCollectionView reloadData];
    
}
- (void)tabBar:(LeveyTabBar *)tabBar didLongPressButton:(NSInteger)index
{
    
    
}

- (void)highlightLongPressed:(UILongPressGestureRecognizer *)longPress
{
    
    
    if (longPress.state == UIGestureRecognizerStateBegan) {
        ViewCustomCell *view = (ViewCustomCell *)longPress.view;
        
        if (![view.contentView.subviews containsObject:_GlobalInfoButton]) {
            selectedIndex = (NSUInteger)view.tag;
            
            if (contextMenu) {
                [self hideContextMenu];
            }
            
            if (!contextMenu) {
                contextMenu = [self getContextMenu];
                [view.contentView addSubview:contextMenu];
                
                NSLog(@"%f", self.navigationController.navigationBar.alpha);
                //                if (self.navigationController.navigationBar.alpha != 0.0) {
                //
                //                    [UIView animateWithDuration:0.7 animations:^{
                //                        self.navigationController.navigationBar.alpha = 0.0;
                //                    }];
                //                }
            }
        }
    }
}

#pragma mark - Youtube share
-(void)presShareYoutube{
    
    if ( youtube==NO) {
        
        UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"Alert" message:@"Go To Setting And Switch On Youtube Share" delegate:self cancelButtonTitle:@"Ok" otherButtonTitles:nil, nil];
        [alert show];

        
    }
    else{
        NSLog(@"selected index %lu",(unsigned long)selectedIndex);
        
        NSURL *urlToVideoOnHardDisk = [videoURLArray objectAtIndex:selectedIndex];
        NSLog(@"print video url---->%@",urlToVideoOnHardDisk);
        //    NSURL *urlToVideoOnHardDisk = [NSURL fileURLWithPath:@"/path/to/the/video.mp4"];
        [youTube uploadVideoAtURL:urlToVideoOnHardDisk];
    }
    
}
- (UIViewController *)ESSYouTubeNeedsCurrentViewControllerToAttachTo:(ESSYouTube *)youtube
{
    return self; //assuming self is the current view controller
}

- (void)ESSYouTubeDidFinish:(ESSYouTube *)youtube
{
    //this gets called whenever the user clicks on Cancel
    //it is also called when the user clicks on Done after the upload has finished.
    //usually, what you want to do here is just autorelease youtube if you don't keep a pointer to the youtube object yourself
    //[youtube autorelease];
}
#pragma mark - facebook share
-(void)presShareMore
{
    
    
    //    NSString *documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
    //
    //    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
    //    NSString *documentsDirectory = [paths objectAtIndex:0];
    //
    //    NSArray *filePathsArray = [[NSFileManager defaultManager] subpathsOfDirectoryAtPath:documentsDirectory  error:nil];
    //
    //    NSLog(@"files array %lu", (unsigned long)[filePathsArray indexOfObject:@"MyHighlights"]);
    //    int inx = (int)[filePathsArray indexOfObject:@"MyHighlights"];
    //    int inxToUse = (int)inx+indexBackup;
    //    NSLog(@"%d",inxToUse);
    //    NSLog(@"%@",[filePathsArray objectAtIndex:inxToUse]);
    //
    //    //  You can get the path for each object in filePathsArray by using the below code
    //
    //    NSString *filePathNew = [documentsDirectory stringByAppendingPathComponent:[filePathsArray objectAtIndex:0]];
    //    NSLog(@"files array %@", filePathNew);
    //
    NSURL *urlToVideoOnHardDisk = [videoURLArray objectAtIndex:selectedIndex];
    //
    //
    //    NSString *filePath = [documentsPath stringByAppendingPathComponent:[filePathsArray objectAtIndex:inxToUse]];
    
    
    NSArray *activityItems = [[NSArray alloc]initWithObjects:urlToVideoOnHardDisk, nil];
    UIActivityViewController *activityViewController = [[UIActivityViewController alloc] initWithActivityItems:activityItems applicationActivities:nil];
    activityViewController.excludedActivityTypes = @[UIActivityTypePostToWeibo, UIActivityTypeAssignToContact ];
    [self presentViewController:activityViewController animated:YES completion:NULL];
    if ([activityViewController respondsToSelector:@selector(popoverPresentationController)])
    {
        // iOS 8+
        UIPopoverPresentationController *presentationController = [activityViewController popoverPresentationController];
        
        // presentationController.sourceView = sender; // if button or change to self.view.
    }
    
    
}

#pragma mark - facebook share
-(void)presShareFb{
    
    NSURL *urlToVideoOnHardDisk = [videoURLArray objectAtIndex:0];
    NSLog(@"print video url---->%@",urlToVideoOnHardDisk);
    
    //  NSURL *urlToVideoOnHardDisk = [NSURL fileURLWithPath:@"/path/to/the/video.mp4"];
    [facebook uploadVideoAtURL:urlToVideoOnHardDisk];
    
}
- (UIViewController *)ESSFacebookNeedsCurrentViewControllerToAttachTo:(ESSFacebook *)facebook
{
    return self; //assuming self is the current view controller
}

- (void)ESSFacebookDidFinish:(ESSFacebook *)fb
{
    //this gets called whenever the user clicks on Cancel
    //it is also called when the user clicks on Done after the upload has finished.
    //usually, what you want to do here is just autorelease youtube if you don't keep a pointer to the facebook object yourself
    // [fb autorelease];
}

#pragma mark - flickr share
-(void)presShareFlickr{
    
    NSURL *urlToVideoOnHardDisk = [videoURLArray objectAtIndex:0];
    // NSURL *urlToVideoOnHardDisk = [NSURL fileURLWithPath:@"/path/to/the/video.mp4"];
    [flickr uploadVideoAtURL:urlToVideoOnHardDisk];
    
    
}
- (UIViewController *)ESSFlickrNeedsViewController:(ESSFlickr *)flickr
{
    return self; //assuming self is the current view controller
}

- (void)ESSFlickrDidFinish:(ESSFlickr *)flickr
{
    
    // stopBtn = [[UIButton alloc] initWithFrame:CGRectMake(act.frame.origin.x+10,122,20, 20)];
    
    // act.frame = CGRectMake(act.frame.origin.x+45, 112, 130, 130);
    
    //this gets called whenever the user clicks on Cancel
    //it is also called when the user clicks on Done after the upload has finished.
    //usually, what you want to do here is just autorelease youtube if you don't keep a pointer to the flickr object yourself
    // [flickr autorelease];
}
-(void)didLogOut
{
    {
        [[NSUserDefaults standardUserDefaults] setObject:@"no" forKey:@"auto_login"];
        
        if([[[NSUserDefaults standardUserDefaults] objectForKey:@"autoLoginPerformed"] isEqualToString:@"yes"])
        {
            
            [[NSUserDefaults standardUserDefaults] setObject:@"no" forKey:@"auto_login"];
            Login *ob=[[Login alloc]init];
            [[NSUserDefaults standardUserDefaults]setValue:@"autoLoginSeAayaMain" forKey:@"loginCheck"];
            [self presentViewController:ob animated:YES completion:nil];
            
        }
        else
        {
            [self dismissViewControllerAnimated:YES completion:nil];
        }
        
        [[NSUserDefaults standardUserDefaults]setValue:@"autoLoginSeNahiAayaMain" forKey:@"loginCheck"];
        [[NSUserDefaults standardUserDefaults] synchronize];
        
        FBSession* session = [FBSession activeSession];
        [session closeAndClearTokenInformation];
        [session close];
        [FBSession setActiveSession:nil];
        
        NSHTTPCookieStorage* cookies = [NSHTTPCookieStorage sharedHTTPCookieStorage];
        NSArray* facebookCookies = [cookies cookiesForURL:[NSURL         URLWithString:@"https://facebook.com/"]];
        
        for (NSHTTPCookie* cookie in facebookCookies)
        {
            [cookies deleteCookie:cookie];
            
        }
        //        [[NSUserDefaults standardUserDefaults]setValue:@"no" forKey:@"autoLoginPerformed"];
        //        [[NSUserDefaults standardUserDefaults] synchronize];
    }
}
@end
